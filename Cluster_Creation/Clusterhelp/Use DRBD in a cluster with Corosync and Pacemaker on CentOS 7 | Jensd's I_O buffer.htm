<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) & !(IE 7) & !(IE 8)]><!-->
<html lang="en-US"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Use DRBD in a cluster with Corosync and Pacemaker on CentOS 7 | Jensd's I/O buffer</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="stylesheet" type="text/css" media="all" href="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/style.css">
<link rel="pingback" href="http://jensd.be/xmlrpc.php">
<!--[if lt IE 9]>
<script src="http://jensd.be/wp-content/themes/twentyeleven/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="Jensd's I/O buffer » Feed" href="http://jensd.be/?feed=rss2">
<link rel="alternate" type="application/rss+xml" title="Jensd's I/O buffer » Comments Feed" href="http://jensd.be/?feed=comments-rss2">
<link rel="alternate" type="application/rss+xml" title="Jensd's I/O buffer » Use DRBD in a cluster with Corosync and Pacemaker on CentOS 7 Comments Feed" href="http://jensd.be/?feed=rss2&amp;p=186">
<link rel="stylesheet" id="crayon-css" href="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/crayon.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-theme-dark-terminal-copy-css" href="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/dark-terminal-copy.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-theme-github-css" href="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/github.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-font-monospace-css" href="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/monospace.css" type="text/css" media="all">
<link rel="stylesheet" id="easy_table_style-css" href="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/style_002.css" type="text/css" media="all">
<script src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/ca-pub-9938673978146131.js" type="text/javascript" async=""></script><script src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/jquery.js"></script>
<script type="text/javascript" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/jquery-migrate.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.6.10","is_admin":"0","ajaxurl":"http:\/\/jensd.be\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type="text/javascript" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/crayon.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://jensd.be/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://jensd.be/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Forward a TCP port to another IP or port using NAT with Iptables" href="http://jensd.be/?p=343">
<link rel="next" title="Write to and manage syslog messages with logger and rsyslog" href="http://jensd.be/?p=372">
<meta name="generator" content="WordPress 4.1.1">
<link rel="canonical" href="http://jensd.be/?p=186">
<link rel="shortlink" href="http://jensd.be/?p=186">
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-54625310-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

<script type="text/javascript" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/widgets.js"></script>
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
</head>

<body data-twttr-rendered="true" class="single single-post postid-186 single-format-standard custom-background single-author singular two-column right-sidebar">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="http://jensd.be/" rel="home">Jensd's I/O buffer</a></span></h1>
				<h2 id="site-description">random technotes…</h2>
			</hgroup>

						<a href="http://jensd.be/">
									<img src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/cropped-technology.jpg" alt="Jensd's I/O buffer" height="287" width="1000">
							</a>
			
								<form method="get" id="searchform" action="http://jensd.be/">
		<label for="s" class="assistive-text">Search</label>
		<input class="field" name="s" id="s" placeholder="Search" type="text">
		<input class="submit" name="submit" id="searchsubmit" value="Search" type="submit">
	</form>
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Main menu</h3>
								<div class="skip-link"><a class="assistive-text" href="#content">Skip to primary content</a></div>
												<div class="menu-menu-1-container"><ul id="menu-menu-1" class="menu"><li id="menu-item-5" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5"><a href="http://www.jensd.be/">Home</a></li>
<li id="menu-item-6" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6"><a href="http://jensd.be/?page_id=2">About me</a></li>
</ul></div>			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<div id="primary">
			<div id="content" role="main">

				
					<nav id="nav-single">
						<h3 class="assistive-text">Post navigation</h3>
						<span class="nav-previous"><a href="http://jensd.be/?p=343" rel="prev"><span class="meta-nav">←</span> Previous</a></span>
						<span class="nav-next"><a href="http://jensd.be/?p=372" rel="next">Next <span class="meta-nav">→</span></a></span>
					</nav><!-- #nav-single -->

					
<article id="post-186" class="post-186 post type-post status-publish format-standard hentry category-apache category-centos category-high-availability category-linux category-network category-red-hat category-rhel">
	<header class="entry-header">
		<h1 class="entry-title">Use DRBD in a cluster with Corosync and Pacemaker on CentOS 7</h1>

				<div class="entry-meta">
			<span class="sep">Posted on </span><a href="http://jensd.be/?p=186" title="16:21" rel="bookmark"><time class="entry-date" datetime="2014-11-21T16:21:48+00:00">21/11/2014</time></a><span class="by-author"> <span class="sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://jensd.be/?author=1" title="View all posts by jensd" rel="author">jensd</a></span></span>		</div><!-- .entry-meta -->
			</header><!-- .entry-header -->

	<div class="entry-content">
		<p><iframe style="width: 63px; height: 20px;" data-twttr-rendered="true" title="Twitter Tweet Button" class="twitter-share-button twitter-tweet-button twitter-share-button twitter-count-none" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/tweet_button.htm" allowtransparency="true" scrolling="no" id="twitter-widget-0" frameborder="0"></iframe></p>
<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:none;margin:10px 0 10px 0;text-align:center;">
<script async="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/adsbygoogle.js"></script>
<!-- lang2 -->
<ins data-adsbygoogle-status="done" class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-9938673978146131" data-ad-slot="1622653003"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;" frameborder="0" height="90" width="728"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<p>When configuring a cluster, you want tot keep managing the server as 
simple as possible. Theoretically, the results given by any node in the 
cluster should be equal as you want the cluster to be transparent to the
 end-user. Part of doing this, is having the same data available on 
every node of the cluster when it’s active. One way to do this, is using
 a central file-share, for example over NFS but this also has 
disadvantages. Another way is to have a distributed file system that 
stays on the nodes itself. DRBD is one of them. This post explains how 
to integrate DRBD in a cluster with Corosync and Pacemaker.</p>
<p><span id="more-186"></span></p>
<p>DRBD stands for&nbsp;Distributed Replicated Block Device and the name
 already explains what it is. DRBD presents a layer on top of a normal 
block device and is responsible for keeping it synchronized over 
multiple nodes. Simplified, you can compare DRBD with a RAID1-array over
 multiple devices in different nodes instead of over multiple devices on
 the same node.</p>
<p>In this post, I will continue with the setup which was created earlier in&nbsp;<a title="Building a high-available failover cluster with Pacemaker, Corosync &amp; PCS" href="http://jensd.be/?p=156">Building a high-available failover cluster with Pacemaker, Corosync &amp; PCS</a>.
 So if you’re looking for the basic configuration of a cluster, have a 
look here. I assume, for this post, that you got a working cluster with 
Corosync and Pacemaker.</p>
<p>The goal of these actions is to have the data for the Apache 
webserver synchronized over both nodes. In the example, the configured 
webserver was presenting the local data which we even used to identify 
the nodes.</p>
<p>Since RHEL 7, Red Hat doesn’t officially support DRBD anymore. 
Support for DRBD is still available via an external partner. This also 
means that CentOS, one of the RHEL derivatives doesn’t have the DRBD 
packages available. Fortunately, ELRepo still provides what we need to 
get going with DRBD.</p>
<h2>Installing DRBD</h2>
<p>More info about ELRepo can be found here: <a href="http://elrepo.org/tiki/drbd83-utils">http://elrepo.org/tiki/drbd83-utils</a>.</p>
<p>The first step in adding DRBD to the existing cluster is to configure the nodes to use the ELRepo-repository:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee18fc467020699" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee18fc467020699-1">1</div><div class="crayon-num" data-line="crayon-551a86aee18fc467020699-2">2</div><div class="crayon-num" data-line="crayon-551a86aee18fc467020699-3">3</div><div class="crayon-num" data-line="crayon-551a86aee18fc467020699-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee18fc467020699-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>rpm<span class="crayon-h"> </span><span class="crayon-o">--</span>import<span class="crayon-h"> </span>https<span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span>www<span class="crayon-sy">.</span>elrepo<span class="crayon-sy">.</span>org<span class="crayon-o">/</span>RPM<span class="crayon-o">-</span>GPG<span class="crayon-o">-</span>KEY<span class="crayon-o">-</span>elrepo<span class="crayon-sy">.</span>org</div><div class="crayon-line" id="crayon-551a86aee18fc467020699-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>yum<span class="crayon-h"> </span>install<span class="crayon-h"> </span>http<span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span>www<span class="crayon-sy">.</span>elrepo<span class="crayon-sy">.</span>org<span class="crayon-o">/</span>elrepo<span class="crayon-o">-</span>release<span class="crayon-o">-</span>7<span class="crayon-sy">.</span>0<span class="crayon-o">-</span>2<span class="crayon-sy">.</span>el7<span class="crayon-sy">.</span>elrepo<span class="crayon-sy">.</span>noarch<span class="crayon-sy">.</span>rpm</div><div class="crayon-line" id="crayon-551a86aee18fc467020699-3"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee18fc467020699-4"><span class="crayon-r ">Complete</span><span class="crayon-h"> </span><span class="crayon-o">!</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0110 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1908660064906" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1908660064906-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1908660064906-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1908660064906-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1908660064906-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1908660064906-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>rpm<span class="crayon-h"> </span><span class="crayon-o">--</span>import<span class="crayon-h"> </span>https<span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span>www<span class="crayon-sy">.</span>elrepo<span class="crayon-sy">.</span>org<span class="crayon-o">/</span>RPM<span class="crayon-o">-</span>GPG<span class="crayon-o">-</span>KEY<span class="crayon-o">-</span>elrepo<span class="crayon-sy">.</span>org</div><div class="crayon-line" id="crayon-551a86aee1908660064906-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>yum<span class="crayon-h"> </span>install<span class="crayon-h"> </span>http<span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span>www<span class="crayon-sy">.</span>elrepo<span class="crayon-sy">.</span>org<span class="crayon-o">/</span>elrepo<span class="crayon-o">-</span>release<span class="crayon-o">-</span>7<span class="crayon-sy">.</span>0<span class="crayon-o">-</span>2<span class="crayon-sy">.</span>el7<span class="crayon-sy">.</span>elrepo<span class="crayon-sy">.</span>noarch<span class="crayon-sy">.</span>rpm</div><div class="crayon-line" id="crayon-551a86aee1908660064906-3"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee1908660064906-4"><span class="crayon-r ">Complete</span><span class="crayon-h"> </span><span class="crayon-o">!</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>After adding the repository, we can install drbd as before:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee190e762286380" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee190e762286380-1">1</div><div class="crayon-num" data-line="crayon-551a86aee190e762286380-2">2</div><div class="crayon-num" data-line="crayon-551a86aee190e762286380-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee190e762286380-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>yum<span class="crayon-h"> </span>install<span class="crayon-h"> </span>drbd84<span class="crayon-o">-</span>utils<span class="crayon-h"> </span>kmod<span class="crayon-o">-</span>drbd84</div><div class="crayon-line" id="crayon-551a86aee190e762286380-2"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee190e762286380-3"><span class="crayon-r ">Complete</span><span class="crayon-h"> </span><span class="crayon-o">!</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1914626933278" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1914626933278-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1914626933278-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1914626933278-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1914626933278-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>yum<span class="crayon-h"> </span>install<span class="crayon-h"> </span>drbd84<span class="crayon-o">-</span>utils<span class="crayon-h"> </span>kmod<span class="crayon-o">-</span>drbd84</div><div class="crayon-line" id="crayon-551a86aee1914626933278-2"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee1914626933278-3"><span class="crayon-r ">Complete</span><span class="crayon-h"> </span><span class="crayon-o">!</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p>
<h2>Create a (logical) volume for DRBD</h2>
<p>DRBD provides a way to distribute a block device over multiple nodes.
 In order to do so, we need a block device to distribute (sound logical,
 doesn’t it). The block device can be any available device, it doesn’t 
need to be a logical volume but can be a pure physical partition too. 
For this post, I’ll add a new logical volume on both nodes to use as my 
distributed block device. The size of the devices needs to be equal on 
all nodes.</p>
<p>First I’ll check if I still have some free space in my volume group to create the logical volume:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee191a167617557" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee191a167617557-1">1</div><div class="crayon-num" data-line="crayon-551a86aee191a167617557-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee191a167617557-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>vgdisplay<span class="crayon-h"> </span>vg<span class="crayon-sy">_</span>drbd<span class="crayon-o">|</span>grep<span class="crayon-h"> </span>Free</div><div class="crayon-line" id="crayon-551a86aee191a167617557-2"><span class="crayon-r ">Free</span><span class="crayon-h"> </span>PE<span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span>Size<span class="crayon-h"> </span>255<span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span>1020<span class="crayon-sy">.</span>00<span class="crayon-h"> </span>MiB</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1920129564408" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1920129564408-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1920129564408-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1920129564408-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>vgdisplay<span class="crayon-h"> </span>vg<span class="crayon-sy">_</span>drbd<span class="crayon-o">|</span>grep<span class="crayon-h"> </span>Free</div><div class="crayon-line" id="crayon-551a86aee1920129564408-2"><span class="crayon-r ">Free</span><span class="crayon-h"> </span>PE<span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span>Size<span class="crayon-h"> </span>255<span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span>1020<span class="crayon-sy">.</span>00<span class="crayon-h"> </span>MiB</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>After checking what is available, I’ll create a new logical volume, named lv_drdb0 in that volume group:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1925141900520" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1925141900520-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1925141900520-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1925141900520-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>lvcreate<span class="crayon-e "> -n</span><span class="crayon-h"> </span>lv<span class="crayon-sy">_</span>drbd0<span class="crayon-e "> -l</span><span class="crayon-h"> </span><span class="crayon-o">+</span>100<span class="crayon-o">%</span>FREE<span class="crayon-h"> </span>vg<span class="crayon-sy">_</span>drbd</div><div class="crayon-line" id="crayon-551a86aee1925141900520-2"><span class="crayon-r ">Logical</span><span class="crayon-h"> </span>volume<span class="crayon-h"> </span><span class="crayon-s">"lv_drbd0"</span><span class="crayon-h"> </span>created</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee192b532120178" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee192b532120178-1">1</div><div class="crayon-num" data-line="crayon-551a86aee192b532120178-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee192b532120178-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>lvcreate<span class="crayon-e "> -n</span><span class="crayon-h"> </span>lv<span class="crayon-sy">_</span>drbd0<span class="crayon-e "> -l</span><span class="crayon-h"> </span><span class="crayon-o">+</span>100<span class="crayon-o">%</span>FREE<span class="crayon-h"> </span>vg<span class="crayon-sy">_</span>drbd</div><div class="crayon-line" id="crayon-551a86aee192b532120178-2"><span class="crayon-r ">Logical</span><span class="crayon-h"> </span>volume<span class="crayon-h"> </span><span class="crayon-s">"lv_drbd0"</span><span class="crayon-h"> </span>created</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>After these steps, both nodes contain a logical volume called lv_drbd0 that are equal in size (1GB).</p>
<h2>Configuring DRBD for&nbsp;Single-primary mode</h2>
<p>Now that we have a block device to share, we’ll configure DRBD to do 
so. Our DRBD setup will be in single-primary mode. This means that only 
one of the nodes can be the primary. This means that the data is only 
manipulated from one point at a time. For other configurations, you will
 need non-standard file systems. The goal of my setup is to use a 
standard file system like EXT3, EXT4 or XFS.</p>
<p>Before we will start configure DRBD, we’ll have to open two TCP-ports
 on our firewall in order for the nodes to communicate with eachother. 
DRBD uses, by default, port 7788 and 7799.</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1931113818875" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1931113818875-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1931113818875-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1931113818875-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1931113818875-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>iptables<span class="crayon-e "> -I</span><span class="crayon-h"> </span>INPUT<span class="crayon-e "> -p</span><span class="crayon-h"> </span>tcp<span class="crayon-e "> -m</span><span class="crayon-h"> </span>state<span class="crayon-h"> </span><span class="crayon-o">--</span>state<span class="crayon-h"> </span>NEW<span class="crayon-e "> -m</span><span class="crayon-h"> </span>tcp<span class="crayon-h"> </span><span class="crayon-o">--</span>dport<span class="crayon-h"> </span>7788<span class="crayon-e "> -j</span><span class="crayon-h"> </span>ACCEPT</div><div class="crayon-line" id="crayon-551a86aee1931113818875-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>iptables<span class="crayon-e "> -I</span><span class="crayon-h"> </span>INPUT<span class="crayon-e "> -p</span><span class="crayon-h"> </span>tcp<span class="crayon-e "> -m</span><span class="crayon-h"> </span>state<span class="crayon-h"> </span><span class="crayon-o">--</span>state<span class="crayon-h"> </span>NEW<span class="crayon-e "> -m</span><span class="crayon-h"> </span>tcp<span class="crayon-h"> </span><span class="crayon-o">--</span>dport<span class="crayon-h"> </span>7799<span class="crayon-e "> -j</span><span class="crayon-h"> </span>ACCEPT</div><div class="crayon-line" id="crayon-551a86aee1931113818875-3"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>service<span class="crayon-h"> </span>iptables<span class="crayon-h"> </span>save</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0018 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1936197619029" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1936197619029-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1936197619029-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1936197619029-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1936197619029-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>iptables<span class="crayon-e "> -I</span><span class="crayon-h"> </span>INPUT<span class="crayon-e "> -p</span><span class="crayon-h"> </span>tcp<span class="crayon-e "> -m</span><span class="crayon-h"> </span>state<span class="crayon-h"> </span><span class="crayon-o">--</span>state<span class="crayon-h"> </span>NEW<span class="crayon-e "> -m</span><span class="crayon-h"> </span>tcp<span class="crayon-h"> </span><span class="crayon-o">--</span>dport<span class="crayon-h"> </span>7788<span class="crayon-e "> -j</span><span class="crayon-h"> </span>ACCEPT</div><div class="crayon-line" id="crayon-551a86aee1936197619029-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>iptables<span class="crayon-e "> -I</span><span class="crayon-h"> </span>INPUT<span class="crayon-e "> -p</span><span class="crayon-h"> </span>tcp<span class="crayon-e "> -m</span><span class="crayon-h"> </span>state<span class="crayon-h"> </span><span class="crayon-o">--</span>state<span class="crayon-h"> </span>NEW<span class="crayon-e "> -m</span><span class="crayon-h"> </span>tcp<span class="crayon-h"> </span><span class="crayon-o">--</span>dport<span class="crayon-h"> </span>7799<span class="crayon-e "> -j</span><span class="crayon-h"> </span>ACCEPT</div><div class="crayon-line" id="crayon-551a86aee1936197619029-3"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>service<span class="crayon-h"> </span>iptables<span class="crayon-h"> </span>save</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>The next step is to create the DRBD configuration files. These files need to be completely equal on all nodes in the cluster.</p>
<p>File&nbsp;/etc/drbd.d/global_common.conf (on node01 and node02):</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee193c511116892" class="crayon-syntax crayon-theme-github crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee193c511116892-1">1</div><div class="crayon-num" data-line="crayon-551a86aee193c511116892-2">2</div><div class="crayon-num" data-line="crayon-551a86aee193c511116892-3">3</div><div class="crayon-num" data-line="crayon-551a86aee193c511116892-4">4</div><div class="crayon-num" data-line="crayon-551a86aee193c511116892-5">5</div><div class="crayon-num" data-line="crayon-551a86aee193c511116892-6">6</div><div class="crayon-num" data-line="crayon-551a86aee193c511116892-7">7</div><div class="crayon-num" data-line="crayon-551a86aee193c511116892-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee193c511116892-1"><span class="crayon-r ">global</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-551a86aee193c511116892-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>usage<span class="crayon-o">-</span>count<span class="crayon-h"> </span>yes<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee193c511116892-3"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-551a86aee193c511116892-4"><span class="crayon-r ">common</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-551a86aee193c511116892-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>net<span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-551a86aee193c511116892-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>protocol<span class="crayon-h"> </span>C<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee193c511116892-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-551a86aee193c511116892-8"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>File&nbsp;/etc/drbd.d/drbd0.res&nbsp;(on node01 and node02):</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1942279139346" class="crayon-syntax crayon-theme-github crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1942279139346-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-6">6</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-7">7</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-8">8</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-9">9</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-10">10</div><div class="crayon-num" data-line="crayon-551a86aee1942279139346-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1942279139346-1"><span class="crayon-r ">resource</span><span class="crayon-h"> </span>drbd0<span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>disk<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>vg<span class="crayon-sy">_</span>drbd<span class="crayon-o">/</span>lv<span class="crayon-sy">_</span>drbd0<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>device<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>meta<span class="crayon-o">-</span>disk<span class="crayon-h"> </span>internal<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>on<span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>address<span class="crayon-h"> </span>192<span class="crayon-sy">.</span>168<span class="crayon-sy">.</span>202<span class="crayon-sy">.</span>101<span class="crayon-o">:</span>7789<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>on<span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>address<span class="crayon-h"> </span>192<span class="crayon-sy">.</span>168<span class="crayon-sy">.</span>202<span class="crayon-sy">.</span>102<span class="crayon-o">:</span>7789<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-551a86aee1942279139346-11"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Now that we have the configuration in place, it’s time to initialize our data:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1948463859286" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1948463859286-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1948463859286-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1948463859286-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1948463859286-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1948463859286-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1948463859286-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1948463859286-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbdadm<span class="crayon-h"> </span>create<span class="crayon-o">-</span><span class="crayon-r">md</span><span class="crayon-h"> </span>drbd0</div><div class="crayon-line" id="crayon-551a86aee1948463859286-2"><span class="crayon-r ">initializing</span><span class="crayon-h"> </span>activity<span class="crayon-h"> </span>log</div><div class="crayon-line" id="crayon-551a86aee1948463859286-3"><span class="crayon-k">NOT</span><span class="crayon-h"> </span>initializing<span class="crayon-h"> </span>bitmap</div><div class="crayon-line" id="crayon-551a86aee1948463859286-4"><span class="crayon-r ">Writing</span><span class="crayon-h"> </span>meta<span class="crayon-h"> </span>data<span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee1948463859286-5"><span class="crayon-r ">New</span><span class="crayon-h"> </span>drbd<span class="crayon-h"> </span>meta<span class="crayon-h"> </span>data<span class="crayon-h"> </span>block<span class="crayon-h"> </span>successfully<span class="crayon-h"> </span>created<span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee1948463859286-6"><span class="crayon-r ">success</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>At this point, we’re ready to start DRBD on both nodes and bring the 
drbd0 resource up. After bringing the resource up, let’s check the 
status:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee194d202114618" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee194d202114618-1">1</div><div class="crayon-num" data-line="crayon-551a86aee194d202114618-2">2</div><div class="crayon-num" data-line="crayon-551a86aee194d202114618-3">3</div><div class="crayon-num" data-line="crayon-551a86aee194d202114618-4">4</div><div class="crayon-num" data-line="crayon-551a86aee194d202114618-5">5</div><div class="crayon-num" data-line="crayon-551a86aee194d202114618-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee194d202114618-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbdadm<span class="crayon-h"> </span>up<span class="crayon-h"> </span>drbd0</div><div class="crayon-line" id="crayon-551a86aee194d202114618-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>cat<span class="crayon-h"> </span><span class="crayon-o">/</span>proc<span class="crayon-o">/</span>drbd</div><div class="crayon-line" id="crayon-551a86aee194d202114618-3"><span class="crayon-r ">version</span><span class="crayon-o">:</span><span class="crayon-h"> </span>8<span class="crayon-sy">.</span>4<span class="crayon-sy">.</span>5<span class="crayon-h"> </span><span class="crayon-sy">(</span>api<span class="crayon-o">:</span>1<span class="crayon-o">/</span>proto<span class="crayon-o">:</span>86<span class="crayon-o">-</span>101<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee194d202114618-4"><span class="crayon-r ">GIT-hash</span><span class="crayon-o">:</span><span class="crayon-h"> </span>1d360bde0e095d495786eaeb2a1ac76888e4db96<span class="crayon-h"> </span>build<span class="crayon-h"> </span>by<span class="crayon-h"> </span>mockbuild<span class="crayon-sy">@</span><span class="crayon-sy">,</span><span class="crayon-h"> </span>2014<span class="crayon-o">-</span>08<span class="crayon-o">-</span>17<span class="crayon-h"> </span>22<span class="crayon-o">:</span>54<span class="crayon-o">:</span>26</div><div class="crayon-line" id="crayon-551a86aee194d202114618-5"><span class="crayon-h"> </span>0<span class="crayon-o">:</span><span class="crayon-h"> </span>cs<span class="crayon-f ">:WFConnection</span><span class="crayon-h"> </span>ro<span class="crayon-f ">:Secondary</span><span class="crayon-o">/</span>Unknown<span class="crayon-h"> </span>ds<span class="crayon-f ">:Inconsistent</span><span class="crayon-o">/</span>DUnknown<span class="crayon-h"> </span>C<span class="crayon-h"> </span>r<span class="crayon-o">--</span><span class="crayon-o">--</span>s</div><div class="crayon-line" id="crayon-551a86aee194d202114618-6"><span class="crayon-h">	</span>ns<span class="crayon-o">:</span>0<span class="crayon-h"> </span>nr<span class="crayon-o">:</span>0<span class="crayon-h"> </span>dw<span class="crayon-o">:</span>0<span class="crayon-h"> </span>dr<span class="crayon-o">:</span>0<span class="crayon-h"> </span>al<span class="crayon-o">:</span>0<span class="crayon-h"> </span>bm<span class="crayon-o">:</span>0<span class="crayon-h"> </span>lo<span class="crayon-o">:</span>0<span class="crayon-h"> </span>pe<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ua<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ap<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ep<span class="crayon-o">:</span>1<span class="crayon-h"> </span>wo<span class="crayon-o">:</span>f<span class="crayon-h"> </span>oos<span class="crayon-o">:</span>1048508</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1953463132686" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1953463132686-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1953463132686-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1953463132686-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1953463132686-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1953463132686-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1953463132686-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1953463132686-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbdadm<span class="crayon-h"> </span>up<span class="crayon-h"> </span>drbd0</div><div class="crayon-line" id="crayon-551a86aee1953463132686-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>cat<span class="crayon-h"> </span><span class="crayon-o">/</span>proc<span class="crayon-o">/</span>drbd</div><div class="crayon-line" id="crayon-551a86aee1953463132686-3"><span class="crayon-r ">version</span><span class="crayon-o">:</span><span class="crayon-h"> </span>8<span class="crayon-sy">.</span>4<span class="crayon-sy">.</span>5<span class="crayon-h"> </span><span class="crayon-sy">(</span>api<span class="crayon-o">:</span>1<span class="crayon-o">/</span>proto<span class="crayon-o">:</span>86<span class="crayon-o">-</span>101<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee1953463132686-4"><span class="crayon-r ">GIT-hash</span><span class="crayon-o">:</span><span class="crayon-h"> </span>1d360bde0e095d495786eaeb2a1ac76888e4db96<span class="crayon-h"> </span>build<span class="crayon-h"> </span>by<span class="crayon-h"> </span>mockbuild<span class="crayon-sy">@</span><span class="crayon-sy">,</span><span class="crayon-h"> </span>2014<span class="crayon-o">-</span>08<span class="crayon-o">-</span>17<span class="crayon-h"> </span>22<span class="crayon-o">:</span>54<span class="crayon-o">:</span>26</div><div class="crayon-line" id="crayon-551a86aee1953463132686-5"><span class="crayon-h"> </span>0<span class="crayon-o">:</span><span class="crayon-h"> </span>cs<span class="crayon-f ">:Connected</span><span class="crayon-h"> </span>ro<span class="crayon-f ">:Secondary</span><span class="crayon-o">/</span>Secondary<span class="crayon-h"> </span>ds<span class="crayon-f ">:Inconsistent</span><span class="crayon-o">/</span>Inconsistent<span class="crayon-h"> </span>C<span class="crayon-h"> </span>r<span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">-</span></div><div class="crayon-line" id="crayon-551a86aee1953463132686-6"><span class="crayon-h">	</span>ns<span class="crayon-o">:</span>0<span class="crayon-h"> </span>nr<span class="crayon-o">:</span>0<span class="crayon-h"> </span>dw<span class="crayon-o">:</span>0<span class="crayon-h"> </span>dr<span class="crayon-o">:</span>0<span class="crayon-h"> </span>al<span class="crayon-o">:</span>0<span class="crayon-h"> </span>bm<span class="crayon-o">:</span>0<span class="crayon-h"> </span>lo<span class="crayon-o">:</span>0<span class="crayon-h"> </span>pe<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ua<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ap<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ep<span class="crayon-o">:</span>1<span class="crayon-h"> </span>wo<span class="crayon-o">:</span>f<span class="crayon-h"> </span>oos<span class="crayon-o">:</span>1048508</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0027 seconds] -->
<p>As you can see in the contents of /proc/drbd, DRBD marks this 
resource as inconsistent. This is because we didn’t tell DRBD who is the
 primary node. In the above output you can see that both nodes are 
thinging that they are the secondary node. All configuration files are 
identical on both nodes so at this point, they’re considered equal.</p>
<p>Let’s configure node01 as the primary and check the status again:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1959076790588" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1959076790588-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1959076790588-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1959076790588-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1959076790588-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1959076790588-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1959076790588-6">6</div><div class="crayon-num" data-line="crayon-551a86aee1959076790588-7">7</div><div class="crayon-num" data-line="crayon-551a86aee1959076790588-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1959076790588-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbdadm<span class="crayon-h"> </span>primary<span class="crayon-h"> </span><span class="crayon-o">--</span>force<span class="crayon-h"> </span>drbd0</div><div class="crayon-line" id="crayon-551a86aee1959076790588-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>cat<span class="crayon-h"> </span><span class="crayon-o">/</span>proc<span class="crayon-o">/</span>drbd</div><div class="crayon-line" id="crayon-551a86aee1959076790588-3"><span class="crayon-r ">version</span><span class="crayon-o">:</span><span class="crayon-h"> </span>8<span class="crayon-sy">.</span>4<span class="crayon-sy">.</span>5<span class="crayon-h"> </span><span class="crayon-sy">(</span>api<span class="crayon-o">:</span>1<span class="crayon-o">/</span>proto<span class="crayon-o">:</span>86<span class="crayon-o">-</span>101<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee1959076790588-4"><span class="crayon-r ">GIT-hash</span><span class="crayon-o">:</span><span class="crayon-h"> </span>1d360bde0e095d495786eaeb2a1ac76888e4db96<span class="crayon-h"> </span>build<span class="crayon-h"> </span>by<span class="crayon-h"> </span>mockbuild<span class="crayon-sy">@</span><span class="crayon-sy">,</span><span class="crayon-h"> </span>2014<span class="crayon-o">-</span>08<span class="crayon-o">-</span>17<span class="crayon-h"> </span>22<span class="crayon-o">:</span>54<span class="crayon-o">:</span>26</div><div class="crayon-line" id="crayon-551a86aee1959076790588-5"><span class="crayon-h"> </span>0<span class="crayon-o">:</span><span class="crayon-h"> </span>cs<span class="crayon-f ">:SyncSource</span><span class="crayon-h"> </span>ro<span class="crayon-f ">:Primary</span><span class="crayon-o">/</span>Secondary<span class="crayon-h"> </span>ds<span class="crayon-f ">:UpToDate</span><span class="crayon-o">/</span>Inconsistent<span class="crayon-h"> </span>C<span class="crayon-h"> </span>r<span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">-</span></div><div class="crayon-line" id="crayon-551a86aee1959076790588-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>ns<span class="crayon-o">:</span>175896<span class="crayon-h"> </span>nr<span class="crayon-o">:</span>0<span class="crayon-h"> </span>dw<span class="crayon-o">:</span>0<span class="crayon-h"> </span>dr<span class="crayon-o">:</span>175896<span class="crayon-h"> </span>al<span class="crayon-o">:</span>0<span class="crayon-h"> </span>bm<span class="crayon-o">:</span>0<span class="crayon-h"> </span>lo<span class="crayon-o">:</span>0<span class="crayon-h"> </span>pe<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ua<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ap<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ep<span class="crayon-o">:</span>1<span class="crayon-h"> </span>wo<span class="crayon-o">:</span>f<span class="crayon-h"> </span>oos<span class="crayon-o">:</span>868516</div><div class="crayon-line" id="crayon-551a86aee1959076790588-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-o">==</span><span class="crayon-o">&gt;</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span><span class="crayon-h"> </span>sync'ed<span class="crayon-o">:</span><span class="crayon-h"> </span>16<span class="crayon-sy">.</span>9<span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span>868516<span class="crayon-o">/</span>1044412<span class="crayon-sy">)</span>K</div><div class="crayon-line" id="crayon-551a86aee1959076790588-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>finish<span class="crayon-o">:</span><span class="crayon-h"> </span>0<span class="crayon-o">:</span>01<span class="crayon-o">:</span>38<span class="crayon-h"> </span>speed<span class="crayon-o">:</span><span class="crayon-h"> </span>8<span class="crayon-sy">,</span>792<span class="crayon-h"> </span><span class="crayon-sy">(</span>8<span class="crayon-sy">,</span>792<span class="crayon-sy">)</span><span class="crayon-h"> </span>K<span class="crayon-o">/</span>sec</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>As you can see in the above output now, the data is synced from 
node01 (which we set as the primary node) to node02 (which is now the 
secondary node. The volume which we used (lv_drbd0) was empty but since 
DRBD is not looking at the contents (blocks) it still needs to 
synchronize the blocks on the volume.</p>
<p>After a while, the synchronization finished and the resource is considered UpToDate:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1960999111100" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1960999111100-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1960999111100-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1960999111100-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1960999111100-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1960999111100-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1960999111100-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>cat<span class="crayon-h"> </span><span class="crayon-o">/</span>proc<span class="crayon-o">/</span>drbd</div><div class="crayon-line" id="crayon-551a86aee1960999111100-2"><span class="crayon-r ">version</span><span class="crayon-o">:</span><span class="crayon-h"> </span>8<span class="crayon-sy">.</span>4<span class="crayon-sy">.</span>5<span class="crayon-h"> </span><span class="crayon-sy">(</span>api<span class="crayon-o">:</span>1<span class="crayon-o">/</span>proto<span class="crayon-o">:</span>86<span class="crayon-o">-</span>101<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee1960999111100-3"><span class="crayon-r ">GIT-hash</span><span class="crayon-o">:</span><span class="crayon-h"> </span>1d360bde0e095d495786eaeb2a1ac76888e4db96<span class="crayon-h"> </span>build<span class="crayon-h"> </span>by<span class="crayon-h"> </span>mockbuild<span class="crayon-sy">@</span><span class="crayon-sy">,</span><span class="crayon-h"> </span>2014<span class="crayon-o">-</span>08<span class="crayon-o">-</span>17<span class="crayon-h"> </span>22<span class="crayon-o">:</span>54<span class="crayon-o">:</span>26</div><div class="crayon-line" id="crayon-551a86aee1960999111100-4"><span class="crayon-h"> </span>0<span class="crayon-o">:</span><span class="crayon-h"> </span>cs<span class="crayon-f ">:Connected</span><span class="crayon-h"> </span>ro<span class="crayon-f ">:Primary</span><span class="crayon-o">/</span>Secondary<span class="crayon-h"> </span>ds<span class="crayon-f ">:UpToDate</span><span class="crayon-o">/</span>UpToDate<span class="crayon-h"> </span>C<span class="crayon-h"> </span>r<span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">-</span></div><div class="crayon-line" id="crayon-551a86aee1960999111100-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>ns<span class="crayon-o">:</span>1044412<span class="crayon-h"> </span>nr<span class="crayon-o">:</span>0<span class="crayon-h"> </span>dw<span class="crayon-o">:</span>0<span class="crayon-h"> </span>dr<span class="crayon-o">:</span>1044412<span class="crayon-h"> </span>al<span class="crayon-o">:</span>0<span class="crayon-h"> </span>bm<span class="crayon-o">:</span>0<span class="crayon-h"> </span>lo<span class="crayon-o">:</span>0<span class="crayon-h"> </span>pe<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ua<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ap<span class="crayon-o">:</span>0<span class="crayon-h"> </span>ep<span class="crayon-o">:</span>1<span class="crayon-h"> </span>wo<span class="crayon-o">:</span>f<span class="crayon-h"> </span>oos<span class="crayon-o">:</span>0</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>To be sure, we can check this in another way. Here you can also clearly see who’s the primary and who’s the secondary:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1966964328477" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1966964328477-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1966964328477-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1966964328477-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbd<span class="crayon-o">-</span>overview</div><div class="crayon-line" id="crayon-551a86aee1966964328477-2"><span class="crayon-h"> </span>0<span class="crayon-f ">:drbd0</span><span class="crayon-o">/</span>0<span class="crayon-h">&nbsp;&nbsp;</span>Connected<span class="crayon-h"> </span>Primary<span class="crayon-o">/</span>Secondary<span class="crayon-h"> </span>UpToDate<span class="crayon-o">/</span>UpToDate</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee196b044197690" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee196b044197690-1">1</div><div class="crayon-num" data-line="crayon-551a86aee196b044197690-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee196b044197690-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbd<span class="crayon-o">-</span>overview</div><div class="crayon-line" id="crayon-551a86aee196b044197690-2"><span class="crayon-h"> </span>0<span class="crayon-f ">:drbd0</span><span class="crayon-o">/</span>0<span class="crayon-h">&nbsp;&nbsp;</span>Connected<span class="crayon-h"> </span>Secondary<span class="crayon-o">/</span>Primary<span class="crayon-h"> </span>UpToDate<span class="crayon-o">/</span>UpToDate</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p>
<h2>&nbsp;Create a file system on the DRBD resource</h2>
<p>Now that the resource is synced over both nodes, we can start 
creating the actual file system for the block device. For DRBD, the 
contents of the file system isn’t important, DRBD only cares that the 
“blocks” are equal on both sides. This will also happen with the file 
system which we create:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1971709914315" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1971709914315-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-6">6</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-7">7</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-8">8</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-9">9</div><div class="crayon-num" data-line="crayon-551a86aee1971709914315-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1971709914315-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>mkfs<span class="crayon-sy">.</span>xfs<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0</div><div class="crayon-line" id="crayon-551a86aee1971709914315-2"><span class="crayon-r ">meta-data</span><span class="crayon-o">=</span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>isize<span class="crayon-o">=</span>256<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>agcount<span class="crayon-o">=</span>4<span class="crayon-sy">,</span><span class="crayon-h"> </span>agsize<span class="crayon-o">=</span>65276<span class="crayon-h"> </span>blks</div><div class="crayon-line" id="crayon-551a86aee1971709914315-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </span>sectsz<span class="crayon-o">=</span>512<span class="crayon-h">&nbsp;&nbsp; </span>attr<span class="crayon-o">=</span>2<span class="crayon-sy">,</span><span class="crayon-h"> </span>projid32bit<span class="crayon-o">=</span>1</div><div class="crayon-line" id="crayon-551a86aee1971709914315-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </span>crc<span class="crayon-o">=</span>0</div><div class="crayon-line" id="crayon-551a86aee1971709914315-5"><span class="crayon-r ">data</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </span>bsize<span class="crayon-o">=</span>4096<span class="crayon-h">&nbsp;&nbsp; </span>blocks<span class="crayon-o">=</span>261103<span class="crayon-sy">,</span><span class="crayon-h"> </span>imaxpct<span class="crayon-o">=</span>25</div><div class="crayon-line" id="crayon-551a86aee1971709914315-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </span>sunit<span class="crayon-o">=</span>0<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>swidth<span class="crayon-o">=</span>0<span class="crayon-h"> </span>blks</div><div class="crayon-line" id="crayon-551a86aee1971709914315-7"><span class="crayon-r ">naming</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-o">=</span>version<span class="crayon-h"> </span>2<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bsize<span class="crayon-o">=</span>4096<span class="crayon-h">&nbsp;&nbsp; </span>ascii<span class="crayon-o">-</span>ci<span class="crayon-o">=</span>0<span class="crayon-h"> </span>ftype<span class="crayon-o">=</span>0</div><div class="crayon-line" id="crayon-551a86aee1971709914315-8"><span class="crayon-r ">log</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span>internal<span class="crayon-h"> </span>log<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>bsize<span class="crayon-o">=</span>4096<span class="crayon-h">&nbsp;&nbsp; </span>blocks<span class="crayon-o">=</span>853<span class="crayon-sy">,</span><span class="crayon-h"> </span>version<span class="crayon-o">=</span>2</div><div class="crayon-line" id="crayon-551a86aee1971709914315-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </span>sectsz<span class="crayon-o">=</span>512<span class="crayon-h">&nbsp;&nbsp; </span>sunit<span class="crayon-o">=</span>0<span class="crayon-h"> </span>blks<span class="crayon-sy">,</span><span class="crayon-h"> </span>lazy<span class="crayon-o">-</span>count<span class="crayon-o">=</span>1</div><div class="crayon-line" id="crayon-551a86aee1971709914315-10"><span class="crayon-r ">realtime</span><span class="crayon-h"> </span><span class="crayon-o">=</span>none<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>extsz<span class="crayon-o">=</span>4096<span class="crayon-h">&nbsp;&nbsp; </span>blocks<span class="crayon-o">=</span>0<span class="crayon-sy">,</span><span class="crayon-h"> </span>rtextents<span class="crayon-o">=</span>0</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<p>After creating a filesystem on the DRBD resource, we can start putting data on the FS:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1977002920311" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1977002920311-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1977002920311-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1977002920311-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1977002920311-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1977002920311-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>mount<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt</div><div class="crayon-line" id="crayon-551a86aee1977002920311-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span><span class="crayon-r">mkdir</span><span class="crayon-h"> </span><span class="crayon-o">/</span>mnt<span class="crayon-o">/</span>test</div><div class="crayon-line" id="crayon-551a86aee1977002920311-3"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>touch<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt<span class="crayon-o">/</span>f1</div><div class="crayon-line" id="crayon-551a86aee1977002920311-4"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>touch<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt<span class="crayon-o">/</span>f2</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p></p>
<h2>Test the failover</h2>
<p>To do a (clean) manual failover, we can simply switch the primary and
 secondary nodes and check if the data got replicated to the second node
 and back:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee197d673907772" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee197d673907772-1">1</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-2">2</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-3">3</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-4">4</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-5">5</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-6">6</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-7">7</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-8">8</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-9">9</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-10">10</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-11">11</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-12">12</div><div class="crayon-num" data-line="crayon-551a86aee197d673907772-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee197d673907772-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>mount<span class="crayon-o">|</span>grep<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0</div><div class="crayon-line" id="crayon-551a86aee197d673907772-2"><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h"> </span>on<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt<span class="crayon-h"> </span><span class="crayon-r">type</span><span class="crayon-h"> </span>xfs<span class="crayon-h"> </span><span class="crayon-sy">(</span>rw<span class="crayon-sy">,</span>relatime<span class="crayon-sy">,</span>seclabel<span class="crayon-sy">,</span>attr2<span class="crayon-sy">,</span>inode64<span class="crayon-sy">,</span>noquota<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee197d673907772-3"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>ls<span class="crayon-e "> -al</span><span class="crayon-h"> </span><span class="crayon-o">/</span>mnt<span class="crayon-o">/</span></div><div class="crayon-line" id="crayon-551a86aee197d673907772-4"><span class="crayon-r ">total</span><span class="crayon-h"> </span>4</div><div class="crayon-line" id="crayon-551a86aee197d673907772-5"><span class="crayon-r ">drwxr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>3<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h"> </span>35<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee197d673907772-6"><span class="crayon-r ">dr-xr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>17<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h"> </span>4096<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>10<span class="crayon-o">:</span>05<span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee197d673907772-7"><span class="crayon-e ">-rw</span><span class="crayon-o">-</span>r<span class="crayon-o">--</span>r<span class="crayon-o">--</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>1<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h"> </span>0<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>f1</div><div class="crayon-line" id="crayon-551a86aee197d673907772-8"><span class="crayon-e ">-rw</span><span class="crayon-o">-</span>r<span class="crayon-o">--</span>r<span class="crayon-o">--</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>1<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h"> </span>0<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>f2</div><div class="crayon-line" id="crayon-551a86aee197d673907772-9"><span class="crayon-r ">drwxr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>2<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h"> </span>6<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>test</div><div class="crayon-line" id="crayon-551a86aee197d673907772-10"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>umount<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt</div><div class="crayon-line" id="crayon-551a86aee197d673907772-11"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbdadm<span class="crayon-h"> </span>secondary<span class="crayon-h"> </span>drbd0</div><div class="crayon-line" id="crayon-551a86aee197d673907772-12"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbd<span class="crayon-o">-</span>overview</div><div class="crayon-line" id="crayon-551a86aee197d673907772-13">0<span class="crayon-f ">:drbd0</span><span class="crayon-o">/</span>0<span class="crayon-h"> </span>Connected<span class="crayon-h"> </span>Secondary<span class="crayon-o">/</span>Secondary<span class="crayon-h"> </span>UpToDate<span class="crayon-o">/</span>UpToDate</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1984704869604" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1984704869604-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-6">6</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-7">7</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-8">8</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-9">9</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-10">10</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-11">11</div><div class="crayon-num" data-line="crayon-551a86aee1984704869604-12">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1984704869604-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbdadm<span class="crayon-h"> </span>primary<span class="crayon-h"> </span>drbd0</div><div class="crayon-line" id="crayon-551a86aee1984704869604-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>mount<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt</div><div class="crayon-line" id="crayon-551a86aee1984704869604-3"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>mount<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt</div><div class="crayon-line" id="crayon-551a86aee1984704869604-4"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>ls<span class="crayon-e "> -al</span><span class="crayon-h"> </span><span class="crayon-o">/</span>mnt<span class="crayon-o">/</span></div><div class="crayon-line" id="crayon-551a86aee1984704869604-5"><span class="crayon-r ">total</span><span class="crayon-h"> </span>4</div><div class="crayon-line" id="crayon-551a86aee1984704869604-6"><span class="crayon-r ">drwxr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h">&nbsp;&nbsp;</span>3<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h">&nbsp;&nbsp; </span>35<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee1984704869604-7"><span class="crayon-r ">dr-xr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>17<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h"> </span>4096<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>10<span class="crayon-o">:</span>04<span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee1984704869604-8"><span class="crayon-e ">-rw</span><span class="crayon-o">-</span>r<span class="crayon-o">--</span>r<span class="crayon-o">--</span><span class="crayon-sy">.</span><span class="crayon-h">&nbsp;&nbsp;</span>1<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>0<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>f1</div><div class="crayon-line" id="crayon-551a86aee1984704869604-9"><span class="crayon-e ">-rw</span><span class="crayon-o">-</span>r<span class="crayon-o">--</span>r<span class="crayon-o">--</span><span class="crayon-sy">.</span><span class="crayon-h">&nbsp;&nbsp;</span>1<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>0<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>f2</div><div class="crayon-line" id="crayon-551a86aee1984704869604-10"><span class="crayon-r ">drwxr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h">&nbsp;&nbsp;</span>2<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>6<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>test</div><div class="crayon-line" id="crayon-551a86aee1984704869604-11"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>drbd<span class="crayon-o">-</span>overview</div><div class="crayon-line" id="crayon-551a86aee1984704869604-12"><span class="crayon-h"> </span>0<span class="crayon-f ">:drbd0</span><span class="crayon-o">/</span>0<span class="crayon-h">&nbsp;&nbsp;</span>Connected<span class="crayon-h"> </span>Primary<span class="crayon-o">/</span>Secondary<span class="crayon-h"> </span>UpToDate<span class="crayon-o">/</span>UpToDate<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt<span class="crayon-h"> </span>xfs<span class="crayon-h"> </span>1017M<span class="crayon-h"> </span>33M<span class="crayon-h"> </span>985M<span class="crayon-h"> </span>4<span class="crayon-o">%</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p>In case you try to mount the resource on a node which is considered secondary, you should a message similar to this:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee198a530287348" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee198a530287348-1">1</div><div class="crayon-num" data-line="crayon-551a86aee198a530287348-2">2</div><div class="crayon-num" data-line="crayon-551a86aee198a530287348-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee198a530287348-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>mount<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt</div><div class="crayon-line" id="crayon-551a86aee198a530287348-2"><span class="crayon-r ">mount</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h"> </span>is<span class="crayon-h"> </span>write<span class="crayon-o">-</span>protected<span class="crayon-sy">,</span><span class="crayon-h"> </span>mounting<span class="crayon-h"> </span>read<span class="crayon-o">-</span>only</div><div class="crayon-line" id="crayon-551a86aee198a530287348-3"><span class="crayon-r ">mount</span><span class="crayon-o">:</span><span class="crayon-h"> </span>mount<span class="crayon-h"> </span><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h"> </span>on<span class="crayon-h"> </span><span class="crayon-o">/</span>mnt<span class="crayon-h"> </span>failed<span class="crayon-o">:</span><span class="crayon-h"> </span>Wrong<span class="crayon-h"> </span>medium<span class="crayon-h"> </span><span class="crayon-r">type</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p></p>
<h2>Add the DRBD resource to our previously configured Pacemaker/Corosync cluster</h2>
<p>In my previous post, I created a cluster with Apache to serve 
webpages in a high available setup. both nodes had to have an identical 
set of webpages in order to server the exact same content regardless of 
which node was the active one. Now we’ll add the DRBD-resource to the 
cluster and move the data for the website to the resource.</p>
<p>To configure DRDB on our cluster, we’ll first edit the configuration 
as we want it to be and then push it to the actual, running 
configuration. To accomplish this, we can create a new CIB (Cluster 
Information Base). Basically it’s a file that contains the complete 
cluster configuration.</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1991140000889" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1991140000889-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1991140000889-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1991140000889-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1991140000889-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-h"> </span>cluster<span class="crayon-h"> </span>cib<span class="crayon-h"> </span>add<span class="crayon-sy">_</span>drbd</div><div class="crayon-line" id="crayon-551a86aee1991140000889-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>ls<span class="crayon-e "> -al</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>drbd</div><div class="crayon-line" id="crayon-551a86aee1991140000889-3"><span class="crayon-e ">-rw</span><span class="crayon-o">-</span>rw<span class="crayon-o">-</span>r<span class="crayon-o">--</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>1<span class="crayon-h"> </span>jensd<span class="crayon-h"> </span>jensd<span class="crayon-h"> </span>6968<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>40<span class="crayon-h"> </span>add<span class="crayon-sy">_</span>drbd</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>If you would look at the contents of the file, you would find the complete, currently active, configuration in there.</p>
<p>Now, let’s add the changes to the cib-file to include our DRBD resource:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1997825068338" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1997825068338-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1997825068338-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1997825068338-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-e "> -f</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>drbd<span class="crayon-h"> </span>resource<span class="crayon-h"> </span>create<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-h"> </span>ocf<span class="crayon-f ">:linbit</span><span class="crayon-f ">:drbd</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>resource<span class="crayon-o">=</span>drbd0<span class="crayon-h"> </span>op<span class="crayon-h"> </span>monitor<span class="crayon-h"> </span>interval<span class="crayon-o">=</span>60s</div><div class="crayon-line" id="crayon-551a86aee1997825068338-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-e "> -f</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>drbd<span class="crayon-h"> </span>resource<span class="crayon-h"> </span>master<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-h"> </span>master<span class="crayon-o">-</span>max<span class="crayon-o">=</span>1<span class="crayon-h"> </span>master<span class="crayon-o">-</span>node<span class="crayon-o">-</span>max<span class="crayon-o">=</span>1<span class="crayon-h"> </span>clone<span class="crayon-o">-</span>max<span class="crayon-o">=</span>2<span class="crayon-h"> </span>clone<span class="crayon-o">-</span>node<span class="crayon-o">-</span>max<span class="crayon-o">=</span>1<span class="crayon-h"> </span>notify<span class="crayon-o">=</span>true</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0019 seconds] -->
<p>We can query the CIB as we would do with the normal active configuration:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee199d347976713" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee199d347976713-1">1</div><div class="crayon-num" data-line="crayon-551a86aee199d347976713-2">2</div><div class="crayon-num" data-line="crayon-551a86aee199d347976713-3">3</div><div class="crayon-num" data-line="crayon-551a86aee199d347976713-4">4</div><div class="crayon-num" data-line="crayon-551a86aee199d347976713-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee199d347976713-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-e "> -f</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>drbd<span class="crayon-h"> </span>resource<span class="crayon-h"> </span>show</div><div class="crayon-line" id="crayon-551a86aee199d347976713-2"><span class="crayon-h"> </span>virtual<span class="crayon-sy">_</span>ip<span class="crayon-h"> </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:IPaddr2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>Started</div><div class="crayon-line" id="crayon-551a86aee199d347976713-3"><span class="crayon-h"> </span>webserver<span class="crayon-h"> </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:apache</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>Started</div><div class="crayon-line" id="crayon-551a86aee199d347976713-4"><span class="crayon-h"> </span>Master<span class="crayon-o">/</span>Slave<span class="crayon-h"> </span><span class="crayon-k">Set</span><span class="crayon-o">:</span><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span><span class="crayon-sy">[</span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee199d347976713-5"><span class="crayon-h"> </span>Stopped<span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>When the configuration is as want it to be, we can activate it by pushing it to the cluster:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19a4318752495" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19a4318752495-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19a4318752495-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19a4318752495-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-h"> </span>cluster<span class="crayon-h"> </span>cib<span class="crayon-o">-</span>push<span class="crayon-h"> </span>add<span class="crayon-sy">_</span>drbd</div><div class="crayon-line" id="crayon-551a86aee19a4318752495-2"><span class="crayon-r ">CIB</span><span class="crayon-h"> </span>updated</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>When looking at the status of our cluster now, we see that something clearly went wrong:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19ad981543869" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-2">2</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-3">3</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-4">4</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-5">5</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-6">6</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-7">7</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-8">8</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-9">9</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-10">10</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-11">11</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-12">12</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-13">13</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-14">14</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-15">15</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-16">16</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-17">17</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-18">18</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-19">19</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-20">20</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-21">21</div><div class="crayon-num" data-line="crayon-551a86aee19ad981543869-22">22</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19ad981543869-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-h"> </span>status</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-2"><span class="crayon-r ">Cluster</span><span class="crayon-h"> </span>name<span class="crayon-o">:</span><span class="crayon-h"> </span>cluster<span class="crayon-sy">_</span>web</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-3"><span class="crayon-r ">Last</span><span class="crayon-h"> </span>updated<span class="crayon-o">:</span><span class="crayon-h"> </span>Fri<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>13<span class="crayon-o">:</span>18<span class="crayon-o">:</span>07<span class="crayon-h"> </span>2014</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-4"><span class="crayon-r ">Last</span><span class="crayon-h"> </span>change<span class="crayon-o">:</span><span class="crayon-h"> </span>Fri<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>13<span class="crayon-o">:</span>17<span class="crayon-o">:</span>55<span class="crayon-h"> </span>2014<span class="crayon-h"> </span>via<span class="crayon-h"> </span>cibadmin<span class="crayon-h"> </span>on<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-5"><span class="crayon-r ">Stack</span><span class="crayon-o">:</span><span class="crayon-h"> </span>corosync</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-6"><span class="crayon-r ">Current</span><span class="crayon-h"> </span>DC<span class="crayon-o">:</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">(</span>1<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span>partition<span class="crayon-h"> </span>with<span class="crayon-h"> </span>quorum</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-7"><span class="crayon-r ">Version</span><span class="crayon-o">:</span><span class="crayon-h"> </span>1<span class="crayon-sy">.</span>1<span class="crayon-sy">.</span>10<span class="crayon-o">-</span>32<span class="crayon-sy">.</span>el7<span class="crayon-sy">_</span>0<span class="crayon-sy">.</span>1<span class="crayon-o">-</span>368c726</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-8">2<span class="crayon-h"> </span>Nodes<span class="crayon-h"> </span>configured</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-9">4<span class="crayon-h"> </span>Resources<span class="crayon-h"> </span>configured</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-10">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-11"><span class="crayon-r ">Online</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee19ad981543869-12"><span class="crayon-r ">Full</span><span class="crayon-h"> </span>list<span class="crayon-h"> </span>of<span class="crayon-h"> </span>resources<span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-551a86aee19ad981543869-13">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-14"><span class="crayon-h"> </span>virtual<span class="crayon-sy">_</span>ip<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:IPaddr2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Started<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-15"><span class="crayon-h"> </span>webserver<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:apache</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Started<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-16"><span class="crayon-h"> </span>Master<span class="crayon-o">/</span>Slave<span class="crayon-h"> </span><span class="crayon-k">Set</span><span class="crayon-o">:</span><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span><span class="crayon-sy">[</span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee19ad981543869-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>linbit<span class="crayon-f ">:drbd</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>FAILED<span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">(</span>unmanaged<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee19ad981543869-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>linbit<span class="crayon-f ">:drbd</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>FAILED<span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">(</span>unmanaged<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee19ad981543869-19">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-20"><span class="crayon-r ">Failed</span><span class="crayon-h"> </span>actions<span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-551a86aee19ad981543869-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>stop<span class="crayon-sy">_</span>0<span class="crayon-h"> </span>on<span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-s">'not installed'</span><span class="crayon-h"> </span><span class="crayon-sy">(</span>5<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-k">call</span><span class="crayon-o">=</span>22<span class="crayon-sy">,</span><span class="crayon-h"> </span>status<span class="crayon-o">=</span>complete<span class="crayon-sy">,</span><span class="crayon-h"> </span>last<span class="crayon-o">-</span>rc<span class="crayon-o">-</span>change<span class="crayon-o">=</span><span class="crayon-s">'Fri Nov 21 13:17:56 2014'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span>queued<span class="crayon-o">=</span>51ms<span class="crayon-sy">,</span><span class="crayon-h"> </span>exec<span class="crayon-o">=</span>0ms</div><div class="crayon-line" id="crayon-551a86aee19ad981543869-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>stop<span class="crayon-sy">_</span>0<span class="crayon-h"> </span>on<span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-s">'not installed'</span><span class="crayon-h"> </span><span class="crayon-sy">(</span>5<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-k">call</span><span class="crayon-o">=</span>18<span class="crayon-sy">,</span><span class="crayon-h"> </span>status<span class="crayon-o">=</span>complete<span class="crayon-sy">,</span><span class="crayon-h"> </span>last<span class="crayon-o">-</span>rc<span class="crayon-o">-</span>change<span class="crayon-o">=</span><span class="crayon-s">'Fri Nov 21 13:17:56 2014'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span>queued<span class="crayon-o">=</span>43ms<span class="crayon-sy">,</span><span class="crayon-h"> </span>exec<span class="crayon-o">=</span>0ms</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0060 seconds] -->
<p>After a little investigation, it seems that the permissions on 
file&nbsp;/var/lib/pacemaker/cores do not allow write from DRBD. It 
found this by looking at /var/log/audit/audit.log:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19bc969965226" class="crayon-syntax crayon-theme-github crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19bc969965226-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19bc969965226-2">2</div><div class="crayon-num" data-line="crayon-551a86aee19bc969965226-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19bc969965226-1"><span class="crayon-r">type</span><span class="crayon-o">=</span>AVC<span class="crayon-h"> </span>msg<span class="crayon-o">=</span>audit<span class="crayon-sy">(</span>1416572808<span class="crayon-sy">.</span>128<span class="crayon-o">:</span>620<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>avc<span class="crayon-o">:</span><span class="crayon-h"> </span>denied<span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span>dac<span class="crayon-sy">_</span>read<span class="crayon-sy">_</span>search<span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-k">for</span><span class="crayon-h"> </span>pid<span class="crayon-o">=</span>27616<span class="crayon-h"> </span>comm<span class="crayon-o">=</span><span class="crayon-s">"drbdadm-84"</span><span class="crayon-h"> </span>capability<span class="crayon-o">=</span>2<span class="crayon-h"> </span>scontext<span class="crayon-o">=</span>system<span class="crayon-sy">_</span>u<span class="crayon-f ">:system_r</span><span class="crayon-f ">:drbd_t</span><span class="crayon-f ">:s0</span><span class="crayon-h"> </span>tcontext<span class="crayon-o">=</span>system<span class="crayon-sy">_</span>u<span class="crayon-f ">:system_r</span><span class="crayon-f ">:drbd_t</span><span class="crayon-f ">:s0</span><span class="crayon-h"> </span>tclass<span class="crayon-o">=</span>capability</div><div class="crayon-line" id="crayon-551a86aee19bc969965226-2"><span class="crayon-r">type</span><span class="crayon-o">=</span>SYSCALL<span class="crayon-h"> </span>msg<span class="crayon-o">=</span>audit<span class="crayon-sy">(</span>1416572808<span class="crayon-sy">.</span>128<span class="crayon-o">:</span>620<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>arch<span class="crayon-o">=</span>c000003e<span class="crayon-h"> </span>syscall<span class="crayon-o">=</span>2<span class="crayon-h"> </span>success<span class="crayon-o">=</span>no<span class="crayon-h"> </span><span class="crayon-r">exit</span><span class="crayon-o">=</span><span class="crayon-o">-</span>13<span class="crayon-h"> </span>a0<span class="crayon-o">=</span>4256d7<span class="crayon-h"> </span>a1<span class="crayon-o">=</span>80000<span class="crayon-h"> </span>a2<span class="crayon-o">=</span>666e6f632e6462<span class="crayon-h"> </span>a3<span class="crayon-o">=</span>7fffe11d3590<span class="crayon-h"> </span>items<span class="crayon-o">=</span>1<span class="crayon-h"> </span>ppid<span class="crayon-o">=</span>27613<span class="crayon-h"> </span>pid<span class="crayon-o">=</span>27616<span class="crayon-h"> </span>auid<span class="crayon-o">=</span>4294967295<span class="crayon-h"> </span>uid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>gid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>euid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>suid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>fsuid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>egid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>sgid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>fsgid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>tty<span class="crayon-o">=</span><span class="crayon-sy">(</span>none<span class="crayon-sy">)</span><span class="crayon-h"> </span>ses<span class="crayon-o">=</span>4294967295<span class="crayon-h"> </span>comm<span class="crayon-o">=</span><span class="crayon-s">"drbdadm-84"</span><span class="crayon-h"> </span>exe<span class="crayon-o">=</span><span class="crayon-s">"/usr/lib/drbd/drbdadm-84"</span><span class="crayon-h"> </span>subj<span class="crayon-o">=</span>system<span class="crayon-sy">_</span>u<span class="crayon-f ">:system_r</span><span class="crayon-f ">:drbd_t</span><span class="crayon-f ">:s0</span><span class="crayon-h"> </span>key<span class="crayon-o">=</span><span class="crayon-sy">(</span>null<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee19bc969965226-3"><span class="crayon-r">type</span><span class="crayon-o">=</span>CWD<span class="crayon-h"> </span>msg<span class="crayon-o">=</span>audit<span class="crayon-sy">(</span>1416572808<span class="crayon-sy">.</span>128<span class="crayon-o">:</span>620<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>cwd<span class="crayon-o">=</span><span class="crayon-s">"/var/lib/pacemaker/cores"</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>The message saying that dac_read_search is denied means that the user
 doesn’t have access to the file but tries to elevate it’s permissions 
to get it.</p>
<p>We’ll change the permissions to world writable (not secure) to fix this on both nodes:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19c7377999757" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19c7377999757-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19c7377999757-2">2</div><div class="crayon-num" data-line="crayon-551a86aee19c7377999757-3">3</div><div class="crayon-num" data-line="crayon-551a86aee19c7377999757-4">4</div><div class="crayon-num" data-line="crayon-551a86aee19c7377999757-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19c7377999757-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>ls<span class="crayon-e "> -al</span><span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>lib<span class="crayon-o">/</span>pacemaker<span class="crayon-o">/</span>cores</div><div class="crayon-line" id="crayon-551a86aee19c7377999757-2"><span class="crayon-r ">total</span><span class="crayon-h"> </span>0</div><div class="crayon-line" id="crayon-551a86aee19c7377999757-3"><span class="crayon-r ">drwxr-x</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>2<span class="crayon-h"> </span>hacluster<span class="crayon-h"> </span>haclient<span class="crayon-h"> </span>6<span class="crayon-h"> </span>Sep<span class="crayon-h"> </span>30<span class="crayon-h"> </span>14<span class="crayon-o">:</span>40<span class="crayon-h"> </span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee19c7377999757-4"><span class="crayon-r ">drwxr-x</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>6<span class="crayon-h"> </span>hacluster<span class="crayon-h"> </span>haclient<span class="crayon-h"> </span>57<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>10<span class="crayon-o">:</span>33<span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee19c7377999757-5"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>chmod<span class="crayon-h"> </span>777<span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>lib<span class="crayon-o">/</span>pacemaker<span class="crayon-o">/</span>cores</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19d1548990857" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19d1548990857-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19d1548990857-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>chmod<span class="crayon-h"> </span>777<span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>lib<span class="crayon-o">/</span>pacemaker<span class="crayon-o">/</span>cores</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>After restarting the cluster, it’s still not working and now we can stil see very similar messages in the audit.log:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19d7193226248" class="crayon-syntax crayon-theme-github crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19d7193226248-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19d7193226248-2">2</div><div class="crayon-num" data-line="crayon-551a86aee19d7193226248-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19d7193226248-1"><span class="crayon-r">type</span><span class="crayon-o">=</span>AVC<span class="crayon-h"> </span>msg<span class="crayon-o">=</span>audit<span class="crayon-sy">(</span>1416573839<span class="crayon-sy">.</span>047<span class="crayon-o">:</span>692<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>avc<span class="crayon-o">:</span><span class="crayon-h"> </span>denied<span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span>read<span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-k">for</span><span class="crayon-h"> </span>pid<span class="crayon-o">=</span>30198<span class="crayon-h"> </span>comm<span class="crayon-o">=</span><span class="crayon-s">"drbdadm-84"</span><span class="crayon-h"> </span>name<span class="crayon-o">=</span><span class="crayon-s">"cores"</span><span class="crayon-h"> </span>dev<span class="crayon-o">=</span><span class="crayon-s">"dm-2"</span><span class="crayon-h"> </span>ino<span class="crayon-o">=</span>16918999<span class="crayon-h"> </span>scontext<span class="crayon-o">=</span>system<span class="crayon-sy">_</span>u<span class="crayon-f ">:system_r</span><span class="crayon-f ">:drbd_t</span><span class="crayon-f ">:s0</span><span class="crayon-h"> </span>tcontext<span class="crayon-o">=</span>system<span class="crayon-sy">_</span>u<span class="crayon-f ">:object_r</span><span class="crayon-f ">:cluster_var_lib_t</span><span class="crayon-f ">:s0</span><span class="crayon-h"> </span>tclass<span class="crayon-o">=</span><span class="crayon-r">dir</span></div><div class="crayon-line" id="crayon-551a86aee19d7193226248-2"><span class="crayon-r">type</span><span class="crayon-o">=</span>SYSCALL<span class="crayon-h"> </span>msg<span class="crayon-o">=</span>audit<span class="crayon-sy">(</span>1416573839<span class="crayon-sy">.</span>047<span class="crayon-o">:</span>692<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>arch<span class="crayon-o">=</span>c000003e<span class="crayon-h"> </span>syscall<span class="crayon-o">=</span>2<span class="crayon-h"> </span>success<span class="crayon-o">=</span>no<span class="crayon-h"> </span><span class="crayon-r">exit</span><span class="crayon-o">=</span><span class="crayon-o">-</span>13<span class="crayon-h"> </span>a0<span class="crayon-o">=</span>4256d7<span class="crayon-h"> </span>a1<span class="crayon-o">=</span>80000<span class="crayon-h"> </span>a2<span class="crayon-o">=</span>666e6f632e6462<span class="crayon-h"> </span>a3<span class="crayon-o">=</span>7fffa43960a0<span class="crayon-h"> </span>items<span class="crayon-o">=</span>1<span class="crayon-h"> </span>ppid<span class="crayon-o">=</span>30197<span class="crayon-h"> </span>pid<span class="crayon-o">=</span>30198<span class="crayon-h"> </span>auid<span class="crayon-o">=</span>4294967295<span class="crayon-h"> </span>uid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>gid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>euid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>suid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>fsuid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>egid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>sgid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>fsgid<span class="crayon-o">=</span>0<span class="crayon-h"> </span>tty<span class="crayon-o">=</span><span class="crayon-sy">(</span>none<span class="crayon-sy">)</span><span class="crayon-h"> </span>ses<span class="crayon-o">=</span>4294967295<span class="crayon-h"> </span>comm<span class="crayon-o">=</span><span class="crayon-s">"drbdadm-84"</span><span class="crayon-h"> </span>exe<span class="crayon-o">=</span><span class="crayon-s">"/usr/lib/drbd/drbdadm-84"</span><span class="crayon-h"> </span>subj<span class="crayon-o">=</span>system<span class="crayon-sy">_</span>u<span class="crayon-f ">:system_r</span><span class="crayon-f ">:drbd_t</span><span class="crayon-f ">:s0</span><span class="crayon-h"> </span>key<span class="crayon-o">=</span><span class="crayon-sy">(</span>null<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee19d7193226248-3"><span class="crayon-r">type</span><span class="crayon-o">=</span>CWD<span class="crayon-h"> </span>msg<span class="crayon-o">=</span>audit<span class="crayon-sy">(</span>1416573839<span class="crayon-sy">.</span>047<span class="crayon-o">:</span>692<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>cwd<span class="crayon-o">=</span><span class="crayon-s">"/var/lib/pacemaker/cores"</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0039 seconds] -->
<p>The difference is that DRBD does have access to the file now but 
SELinux is trying to prevent access. To see which SELinux boolean we 
need to enable, if there is one to allow access:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19dd585495598" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-2">2</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-3">3</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-4">4</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-5">5</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-6">6</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-7">7</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-8">8</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-9">9</div><div class="crayon-num" data-line="crayon-551a86aee19dd585495598-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19dd585495598-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>tail<span class="crayon-h"> </span><span class="crayon-o">-</span>200<span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>log<span class="crayon-o">/</span>audit<span class="crayon-o">/</span>audit<span class="crayon-sy">.</span>log<span class="crayon-o">|</span>grep<span class="crayon-h"> </span>AVC<span class="crayon-o">|</span>tail<span class="crayon-h"> </span><span class="crayon-o">-</span>1<span class="crayon-o">|</span>audit2allow<span class="crayon-e "> -m</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>0</div><div class="crayon-line" id="crayon-551a86aee19dd585495598-2"><span class="crayon-r ">module</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>0<span class="crayon-h"> </span>1<span class="crayon-sy">.</span>0<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee19dd585495598-3"><span class="crayon-r ">require</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-551a86aee19dd585495598-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">type</span><span class="crayon-h"> </span>cluster<span class="crayon-sy">_</span>var<span class="crayon-sy">_</span>lib<span class="crayon-sy">_</span>t<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee19dd585495598-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">type</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>t<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee19dd585495598-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>class<span class="crayon-h"> </span><span class="crayon-r">dir</span><span class="crayon-h"> </span>read<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee19dd585495598-7"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-551a86aee19dd585495598-8"><span class="crayon-o">#</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">=</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>t<span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">==</span></div><div class="crayon-line" id="crayon-551a86aee19dd585495598-9"><span class="crayon-o">#</span><span class="crayon-o">!</span><span class="crayon-o">!</span><span class="crayon-o">!</span><span class="crayon-o">!</span><span class="crayon-h"> </span>This<span class="crayon-h"> </span>avc<span class="crayon-h"> </span>can<span class="crayon-h"> </span>be<span class="crayon-h"> </span>allowed<span class="crayon-h"> </span>using<span class="crayon-h"> </span>the<span class="crayon-h"> </span>boolean<span class="crayon-h"> </span><span class="crayon-s">'daemons_enable_cluster_mode'</span></div><div class="crayon-line" id="crayon-551a86aee19dd585495598-10"><span class="crayon-r ">allow</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>t<span class="crayon-h"> </span>cluster<span class="crayon-sy">_</span>var<span class="crayon-sy">_</span>lib<span class="crayon-sy">_</span>t<span class="crayon-f ">:dir</span><span class="crayon-h"> </span>read<span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>As the output of audit2allow states, we can set&nbsp;daemons_enable_cluster_mode to enabled on both nodes to fix this:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19e3159708802" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19e3159708802-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19e3159708802-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>setsebool<span class="crayon-h"> </span>daemons<span class="crayon-sy">_</span>enable<span class="crayon-sy">_</span>cluster<span class="crayon-sy">_</span>mode<span class="crayon-o">=</span>1</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19e9650608128" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19e9650608128-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19e9650608128-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>setsebool<span class="crayon-h"> </span>daemons<span class="crayon-sy">_</span>enable<span class="crayon-sy">_</span>cluster<span class="crayon-sy">_</span>mode<span class="crayon-o">=</span>1</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>When restarting the cluster, things should look a little better. 
Unfortunately, there is still a problem which doesn’t allow us to stop 
the cluster. Again SELinux is not allow us to take this action. Which is
 clear when looking at /var/log/audit/audit.log:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19ee015051755" class="crayon-syntax crayon-theme-github crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19ee015051755-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19ee015051755-1"><span class="crayon-r">type</span><span class="crayon-o">=</span>AVC<span class="crayon-h"> </span>msg<span class="crayon-o">=</span>audit<span class="crayon-sy">(</span>1416575077<span class="crayon-sy">.</span>693<span class="crayon-o">:</span>1532<span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span>avc<span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span>denied<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span>sys<span class="crayon-sy">_</span>admin<span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-k">for</span><span class="crayon-h">&nbsp;&nbsp;</span>pid<span class="crayon-o">=</span>40528<span class="crayon-h"> </span>comm<span class="crayon-o">=</span><span class="crayon-s">"drbdsetup-84"</span><span class="crayon-h"> </span>capability<span class="crayon-o">=</span>21<span class="crayon-h">&nbsp;&nbsp;</span>scontext<span class="crayon-o">=</span>system<span class="crayon-sy">_</span>u<span class="crayon-f ">:system_r</span><span class="crayon-f ">:drbd_t</span><span class="crayon-f ">:s0</span><span class="crayon-h"> </span>tcontext<span class="crayon-o">=</span>system<span class="crayon-sy">_</span>u<span class="crayon-f ">:system_r</span><span class="crayon-f ">:drbd_t</span><span class="crayon-f ">:s0</span><span class="crayon-h"> </span>tclass<span class="crayon-o">=</span>capability</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>We can allow this action by creating a new SELinux module and to load it:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19f4430179940" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-2">2</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-3">3</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-4">4</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-5">5</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-6">6</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-7">7</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-8">8</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-9">9</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-10">10</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-11">11</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-12">12</div><div class="crayon-num" data-line="crayon-551a86aee19f4430179940-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19f4430179940-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>tail<span class="crayon-h"> </span><span class="crayon-o">-</span>100<span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>log<span class="crayon-o">/</span>audit<span class="crayon-o">/</span>audit<span class="crayon-sy">.</span>log<span class="crayon-o">|</span>grep<span class="crayon-h"> </span>AVC<span class="crayon-o">|</span>tail<span class="crayon-h"> </span><span class="crayon-o">-</span>1<span class="crayon-o">|</span>audit2allow<span class="crayon-e "> -M</span><span class="crayon-h"> </span>drdb<span class="crayon-sy">_</span>1</div><div class="crayon-line" id="crayon-551a86aee19f4430179940-2"><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span>IMPORTANT<span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-o">*</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-3"><span class="crayon-r ">To</span><span class="crayon-h"> </span>make<span class="crayon-h"> </span>this<span class="crayon-h"> </span>policy<span class="crayon-h"> </span>package<span class="crayon-h"> </span>active<span class="crayon-sy">,</span><span class="crayon-h"> </span>execute<span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-4"><span class="crayon-r ">semodule</span><span class="crayon-e "> -i</span><span class="crayon-h"> </span>drdb<span class="crayon-sy">_</span>1<span class="crayon-sy">.</span>pp</div><div class="crayon-line" id="crayon-551a86aee19f4430179940-5"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>cat<span class="crayon-h"> </span>drdb<span class="crayon-sy">_</span>1<span class="crayon-sy">.</span>te</div><div class="crayon-line" id="crayon-551a86aee19f4430179940-6"><span class="crayon-r ">module</span><span class="crayon-h"> </span>drdb<span class="crayon-sy">_</span>1<span class="crayon-h"> </span>1<span class="crayon-sy">.</span>0<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-7"><span class="crayon-r ">require</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">type</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>t<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>class<span class="crayon-h"> </span>capability<span class="crayon-h"> </span>sys<span class="crayon-sy">_</span>admin<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-10"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-11"><span class="crayon-o">#</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">=</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>t<span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">==</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-12"><span class="crayon-r ">allow</span><span class="crayon-h"> </span>drbd<span class="crayon-sy">_</span>t<span class="crayon-h"> </span>self<span class="crayon-f ">:capability</span><span class="crayon-h"> </span>sys<span class="crayon-sy">_</span>admin<span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-551a86aee19f4430179940-13"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>semodule<span class="crayon-e "> -i</span><span class="crayon-h"> </span>drdb<span class="crayon-sy">_</span>1<span class="crayon-sy">.</span>pp</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>We’ll copy the module to node02 and load it there too:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19fa766955563" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19fa766955563-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19fa766955563-2">2</div><div class="crayon-num" data-line="crayon-551a86aee19fa766955563-3">3</div><div class="crayon-num" data-line="crayon-551a86aee19fa766955563-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19fa766955563-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>scp<span class="crayon-h"> </span>node01<span class="crayon-o">:</span><span class="crayon-o">/</span>home<span class="crayon-o">/</span>jensd<span class="crayon-o">/</span>drdb<span class="crayon-sy">_</span>1<span class="crayon-sy">.</span>pp<span class="crayon-h"> </span><span class="crayon-o">~</span></div><div class="crayon-line" id="crayon-551a86aee19fa766955563-2"><span class="crayon-r ">jensd</span><span class="crayon-sy">@</span>node01's<span class="crayon-h"> </span>password<span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-551a86aee19fa766955563-3"><span class="crayon-r ">drdb_1.pp</span></div><div class="crayon-line" id="crayon-551a86aee19fa766955563-4"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>semodule<span class="crayon-e "> -i</span><span class="crayon-h"> </span>drdb<span class="crayon-sy">_</span>1<span class="crayon-sy">.</span>pp</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Now we can stop and start the cluster again and the output of the status command looks better:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee19ff869563407" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-1">1</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-2">2</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-3">3</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-4">4</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-5">5</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-6">6</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-7">7</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-8">8</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-9">9</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-10">10</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-11">11</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-12">12</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-13">13</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-14">14</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-15">15</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-16">16</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-17">17</div><div class="crayon-num" data-line="crayon-551a86aee19ff869563407-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee19ff869563407-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-h"> </span>status</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-2"><span class="crayon-r ">Cluster</span><span class="crayon-h"> </span>name<span class="crayon-o">:</span><span class="crayon-h"> </span>cluster<span class="crayon-sy">_</span>web</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-3"><span class="crayon-r ">Last</span><span class="crayon-h"> </span>updated<span class="crayon-o">:</span><span class="crayon-h"> </span>Fri<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>14<span class="crayon-o">:</span>24<span class="crayon-o">:</span>28<span class="crayon-h"> </span>2014</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-4"><span class="crayon-r ">Last</span><span class="crayon-h"> </span>change<span class="crayon-o">:</span><span class="crayon-h"> </span>Fri<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>14<span class="crayon-o">:</span>01<span class="crayon-o">:</span>04<span class="crayon-h"> </span>2014<span class="crayon-h"> </span>via<span class="crayon-h"> </span>cibadmin<span class="crayon-h"> </span>on<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-5"><span class="crayon-r ">Stack</span><span class="crayon-o">:</span><span class="crayon-h"> </span>corosync</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-6"><span class="crayon-r ">Current</span><span class="crayon-h"> </span>DC<span class="crayon-o">:</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">(</span>1<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span>partition<span class="crayon-h"> </span>with<span class="crayon-h"> </span>quorum</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-7"><span class="crayon-r ">Version</span><span class="crayon-o">:</span><span class="crayon-h"> </span>1<span class="crayon-sy">.</span>1<span class="crayon-sy">.</span>10<span class="crayon-o">-</span>32<span class="crayon-sy">.</span>el7<span class="crayon-sy">_</span>0<span class="crayon-sy">.</span>1<span class="crayon-o">-</span>368c726</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-8">2<span class="crayon-h"> </span>Nodes<span class="crayon-h"> </span>configured</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-9">4<span class="crayon-h"> </span>Resources<span class="crayon-h"> </span>configured</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-10">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-11"><span class="crayon-r ">Online</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee19ff869563407-12">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-13"><span class="crayon-r ">Full</span><span class="crayon-h"> </span>list<span class="crayon-h"> </span>of<span class="crayon-h"> </span>resources<span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-551a86aee19ff869563407-14"><span class="crayon-h"> </span>virtual<span class="crayon-sy">_</span>ip<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:IPaddr2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Started<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-15"><span class="crayon-h"> </span>webserver<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:apache</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Started<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee19ff869563407-16"><span class="crayon-h"> </span>Master<span class="crayon-o">/</span>Slave<span class="crayon-h"> </span><span class="crayon-k">Set</span><span class="crayon-o">:</span><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span><span class="crayon-sy">[</span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee19ff869563407-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>Masters<span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee19ff869563407-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>Slaves<span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>The above output shows that the resource is successfully added and is
 started but since our master was still node02, this isn’t really how we
 want it. The master should be the node that is owning the virtual IP 
and is running the webserver.</p>
<p>First, we’ll create a filesystem resource on the cluster, using a new cib-file:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a06791370107" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a06791370107-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a06791370107-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a06791370107-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-h"> </span>cluster<span class="crayon-h"> </span>cib<span class="crayon-h"> </span>add<span class="crayon-sy">_</span>fs</div><div class="crayon-line" id="crayon-551a86aee1a06791370107-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-e "> -f</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>resource<span class="crayon-h"> </span>create<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>Filesystem<span class="crayon-h"> </span>device<span class="crayon-o">=</span><span class="crayon-s">"/dev/drbd0"</span><span class="crayon-h"> </span>directory<span class="crayon-o">=</span><span class="crayon-s">"/var/www/html"</span><span class="crayon-h"> </span>fstype<span class="crayon-o">=</span><span class="crayon-s">"xfs"</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Then we’ll create some constraints for the added resource:<br>
The filesystem of the webserver should be made available on the master:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a0c310926083" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a0c310926083-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a0c310926083-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-e "> -f</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>constraint<span class="crayon-h"> </span>colocation<span class="crayon-h"> </span>add<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span>INFINITY<span class="crayon-h"> </span>with<span class="crayon-o">-</span>rsc<span class="crayon-o">-</span>role<span class="crayon-o">=</span>Master</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>DRBD should first be started and then the file system should be made available:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a11739402699" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a11739402699-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a11739402699-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a11739402699-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-e "> -f</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>constraint<span class="crayon-h"> </span>order<span class="crayon-h"> </span>promote<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span>then<span class="crayon-h"> </span><span class="crayon-k">start</span><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs</div><div class="crayon-line" id="crayon-551a86aee1a11739402699-2"><span class="crayon-r ">Adding</span><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span><span class="crayon-sy">(</span>kind<span class="crayon-o">:</span><span class="crayon-h"> </span>Mandatory<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">(</span>Options<span class="crayon-o">:</span><span class="crayon-h"> </span>first<span class="crayon-o">-</span>action<span class="crayon-o">=</span>promote<span class="crayon-h"> </span>then<span class="crayon-o">-</span>action<span class="crayon-o">=</span><span class="crayon-k">start</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>Apache and the file system should be running on the same node</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a17400850893" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a17400850893-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a17400850893-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-e "> -f</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>constraint<span class="crayon-h"> </span>colocation<span class="crayon-h"> </span>add<span class="crayon-h"> </span>webserver<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>INFINITY</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>The file system needs to be made available before Apache is started:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a1d626782768" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a1d626782768-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a1d626782768-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a1d626782768-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-e "> -f</span><span class="crayon-h"> </span>add<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>constraint<span class="crayon-h"> </span>order<span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>then<span class="crayon-h"> </span>webserver</div><div class="crayon-line" id="crayon-551a86aee1a1d626782768-2"><span class="crayon-r ">Adding</span><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs<span class="crayon-h"> </span>webserver<span class="crayon-h"> </span><span class="crayon-sy">(</span>kind<span class="crayon-o">:</span><span class="crayon-h"> </span>Mandatory<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">(</span>Options<span class="crayon-o">:</span><span class="crayon-h"> </span>first<span class="crayon-o">-</span>action<span class="crayon-o">=</span><span class="crayon-k">start</span><span class="crayon-h"> </span>then<span class="crayon-o">-</span>action<span class="crayon-o">=</span><span class="crayon-k">start</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Next step is to acutally apply the changes which we made in the cib-file on the actual running configuration:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a22544635800" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a22544635800-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a22544635800-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a22544635800-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-h"> </span>cluster<span class="crayon-h"> </span>cib<span class="crayon-o">-</span>push<span class="crayon-h"> </span>add<span class="crayon-sy">_</span>fs</div><div class="crayon-line" id="crayon-551a86aee1a22544635800-2"><span class="crayon-r ">CIB</span><span class="crayon-h"> </span>updated</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Normally, the actions should be performed immediately but I had to 
stop and start the cluster in order to get things working but this 
should be the result:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a28714169515" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-6">6</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-7">7</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-8">8</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-9">9</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-10">10</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-11">11</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-12">12</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-13">13</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-14">14</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-15">15</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-16">16</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-17">17</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-18">18</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-19">19</div><div class="crayon-num" data-line="crayon-551a86aee1a28714169515-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a28714169515-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-h"> </span>status</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-2"><span class="crayon-r ">Cluster</span><span class="crayon-h"> </span>name<span class="crayon-o">:</span><span class="crayon-h"> </span>cluster<span class="crayon-sy">_</span>web</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-3"><span class="crayon-r ">Last</span><span class="crayon-h"> </span>updated<span class="crayon-o">:</span><span class="crayon-h"> </span>Fri<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>15<span class="crayon-o">:</span>05<span class="crayon-o">:</span>22<span class="crayon-h"> </span>2014</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-4"><span class="crayon-r ">Last</span><span class="crayon-h"> </span>change<span class="crayon-o">:</span><span class="crayon-h"> </span>Fri<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>15<span class="crayon-o">:</span>05<span class="crayon-o">:</span>13<span class="crayon-h"> </span>2014<span class="crayon-h"> </span>via<span class="crayon-h"> </span>cibadmin<span class="crayon-h"> </span>on<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-5"><span class="crayon-r ">Stack</span><span class="crayon-o">:</span><span class="crayon-h"> </span>corosync</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-6"><span class="crayon-r ">Current</span><span class="crayon-h"> </span>DC<span class="crayon-o">:</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">(</span>1<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span>partition<span class="crayon-h"> </span>with<span class="crayon-h"> </span>quorum</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-7"><span class="crayon-r ">Version</span><span class="crayon-o">:</span><span class="crayon-h"> </span>1<span class="crayon-sy">.</span>1<span class="crayon-sy">.</span>10<span class="crayon-o">-</span>32<span class="crayon-sy">.</span>el7<span class="crayon-sy">_</span>0<span class="crayon-sy">.</span>1<span class="crayon-o">-</span>368c726</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-8">2<span class="crayon-h"> </span>Nodes<span class="crayon-h"> </span>configured</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-9">5<span class="crayon-h"> </span>Resources<span class="crayon-h"> </span>configured</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-10">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-11"><span class="crayon-r ">Online</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a28714169515-12">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-13"><span class="crayon-r ">Full</span><span class="crayon-h"> </span>list<span class="crayon-h"> </span>of<span class="crayon-h"> </span>resources<span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-551a86aee1a28714169515-14">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-15"><span class="crayon-h"> </span>virtual<span class="crayon-sy">_</span>ip<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:IPaddr2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Started<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-16"><span class="crayon-h"> </span>webserver<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:apache</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Started<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee1a28714169515-17"><span class="crayon-h"> </span>Master<span class="crayon-o">/</span>Slave<span class="crayon-h"> </span><span class="crayon-k">Set</span><span class="crayon-o">:</span><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span><span class="crayon-sy">[</span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a28714169515-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>Masters<span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a28714169515-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>Slaves<span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a28714169515-20"><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:Filesystem</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>Started<span class="crayon-h"> </span>node01</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p>As the output shows, the DRBD master has become node01 and all 
resources were started on that node. Our constraints made sure that 
before the webserver was started, the virtual IP was available and that 
the DRBD-resource was mounted and available.</p>
<p>To be sure that the DRBD configuration went fine, we can check if our filesystem-resource did it’s work:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a2f595167552" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-6">6</div><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-7">7</div><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-8">8</div><div class="crayon-num" data-line="crayon-551a86aee1a2f595167552-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a2f595167552-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>mount<span class="crayon-o">|</span>grep<span class="crayon-h"> </span>drbd0</div><div class="crayon-line" id="crayon-551a86aee1a2f595167552-2"><span class="crayon-o">/</span>dev<span class="crayon-o">/</span>drbd0<span class="crayon-h"> </span>on<span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>www<span class="crayon-o">/</span>html<span class="crayon-h"> </span><span class="crayon-r">type</span><span class="crayon-h"> </span>xfs<span class="crayon-h"> </span><span class="crayon-sy">(</span>rw<span class="crayon-sy">,</span>relatime<span class="crayon-sy">,</span>seclabel<span class="crayon-sy">,</span>attr2<span class="crayon-sy">,</span>inode64<span class="crayon-sy">,</span>noquota<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-551a86aee1a2f595167552-3"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node01<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>ls<span class="crayon-e "> -al</span><span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>www<span class="crayon-o">/</span>html<span class="crayon-o">/</span></div><div class="crayon-line" id="crayon-551a86aee1a2f595167552-4"><span class="crayon-r ">total</span><span class="crayon-h"> </span>0</div><div class="crayon-line" id="crayon-551a86aee1a2f595167552-5"><span class="crayon-r ">drwxr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>3<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h"> </span>35<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>15<span class="crayon-o">:</span>07<span class="crayon-h"> </span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee1a2f595167552-6"><span class="crayon-r ">drwxr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>4<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h"> </span>31<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>10<span class="crayon-o">:</span>33<span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-551a86aee1a2f595167552-7"><span class="crayon-e ">-rw</span><span class="crayon-o">-</span>r<span class="crayon-o">--</span>r<span class="crayon-o">--</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>1<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h">&nbsp;&nbsp;</span>0<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>f1</div><div class="crayon-line" id="crayon-551a86aee1a2f595167552-8"><span class="crayon-e ">-rw</span><span class="crayon-o">-</span>r<span class="crayon-o">--</span>r<span class="crayon-o">--</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>1<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h">&nbsp;&nbsp;</span>0<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>f2</div><div class="crayon-line" id="crayon-551a86aee1a2f595167552-9"><span class="crayon-r ">drwxr-xr-x</span><span class="crayon-sy">.</span><span class="crayon-h"> </span>2<span class="crayon-h"> </span>root<span class="crayon-h"> </span>root<span class="crayon-h">&nbsp;&nbsp;</span>6<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>12<span class="crayon-o">:</span>26<span class="crayon-h"> </span>test</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<p>Finally, we can add data for our website to the mount:&nbsp;Let’s start with creating an index.html on our DRBD file system:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a35193248891" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a35193248891-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a35193248891-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1a35193248891-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1a35193248891-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1a35193248891-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a35193248891-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>vi<span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>www<span class="crayon-o">/</span>html<span class="crayon-o">/</span>index<span class="crayon-sy">.</span>html</div><div class="crayon-line" id="crayon-551a86aee1a35193248891-2"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>cat<span class="crayon-h"> </span><span class="crayon-o">/</span>var<span class="crayon-o">/</span>www<span class="crayon-o">/</span>html<span class="crayon-o">/</span>index<span class="crayon-sy">.</span>html</div><div class="crayon-line" id="crayon-551a86aee1a35193248891-3"><span class="crayon-o">&lt;</span>html<span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-551a86aee1a35193248891-4"><span class="crayon-h"> </span><span class="crayon-o">&lt;</span>h1<span class="crayon-o">&gt;</span>DRBD<span class="crayon-o">&lt;</span><span class="crayon-o">/</span>h1<span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-551a86aee1a35193248891-5"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span>html<span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>When stopping node01, everything should switch to node02 including the data which we just modified on node01:</p>
<p>[jensd@node01 ~]$ sudo pcs cluster stop<br>
Stopping Cluster…</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a3a163285961" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -25px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-4">4</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-5">5</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-6">6</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-7">7</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-8">8</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-9">9</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-10">10</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-11">11</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-12">12</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-13">13</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-14">14</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-15">15</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-16">16</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-17">17</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-18">18</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-19">19</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-20">20</div><div class="crayon-num" data-line="crayon-551a86aee1a3a163285961-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a3a163285961-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>sudo<span class="crayon-h"> </span>pcs<span class="crayon-h"> </span>status</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-2"><span class="crayon-r ">Cluster</span><span class="crayon-h"> </span>name<span class="crayon-o">:</span><span class="crayon-h"> </span>cluster<span class="crayon-sy">_</span>web</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-3"><span class="crayon-r ">Last</span><span class="crayon-h"> </span>updated<span class="crayon-o">:</span><span class="crayon-h"> </span>Fri<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>15<span class="crayon-o">:</span>12<span class="crayon-o">:</span>27<span class="crayon-h"> </span>2014</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-4"><span class="crayon-r ">Last</span><span class="crayon-h"> </span>change<span class="crayon-o">:</span><span class="crayon-h"> </span>Fri<span class="crayon-h"> </span>Nov<span class="crayon-h"> </span>21<span class="crayon-h"> </span>15<span class="crayon-o">:</span>05<span class="crayon-o">:</span>13<span class="crayon-h"> </span>2014<span class="crayon-h"> </span>via<span class="crayon-h"> </span>cibadmin<span class="crayon-h"> </span>on<span class="crayon-h"> </span>node01</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-5"><span class="crayon-r ">Stack</span><span class="crayon-o">:</span><span class="crayon-h"> </span>corosync</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-6"><span class="crayon-r ">Current</span><span class="crayon-h"> </span>DC<span class="crayon-o">:</span><span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">(</span>2<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span>partition<span class="crayon-h"> </span>with<span class="crayon-h"> </span>quorum</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-7"><span class="crayon-r ">Version</span><span class="crayon-o">:</span><span class="crayon-h"> </span>1<span class="crayon-sy">.</span>1<span class="crayon-sy">.</span>10<span class="crayon-o">-</span>32<span class="crayon-sy">.</span>el7<span class="crayon-sy">_</span>0<span class="crayon-sy">.</span>1<span class="crayon-o">-</span>368c726</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-8">2<span class="crayon-h"> </span>Nodes<span class="crayon-h"> </span>configured</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-9">5<span class="crayon-h"> </span>Resources<span class="crayon-h"> </span>configured</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-10">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-11"><span class="crayon-r ">Online</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-12"><span class="crayon-r ">OFFLINE</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-13">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-14"><span class="crayon-r ">Full</span><span class="crayon-h"> </span>list<span class="crayon-h"> </span>of<span class="crayon-h"> </span>resources<span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-15">&nbsp;</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-16"><span class="crayon-h"> </span>virtual<span class="crayon-sy">_</span>ip<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:IPaddr2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Started<span class="crayon-h"> </span>node02</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-17"><span class="crayon-h"> </span>webserver<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:apache</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Started<span class="crayon-h"> </span>node02</div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-18"><span class="crayon-h"> </span>Master<span class="crayon-o">/</span>Slave<span class="crayon-h"> </span><span class="crayon-k">Set</span><span class="crayon-o">:</span><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">_</span>sync<span class="crayon-h"> </span><span class="crayon-sy">[</span>webserver<span class="crayon-sy">_</span>data<span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>Masters<span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node02<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>Stopped<span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span>node01<span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-551a86aee1a3a163285961-21"><span class="crayon-h"> </span>webserver<span class="crayon-sy">_</span>fs<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-sy">(</span>ocf<span class="crayon-o">::</span>heartbeat<span class="crayon-f ">:Filesystem</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>Started<span class="crayon-h"> </span>node02</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0042 seconds] -->
<p>When checking the website, we get the modified webpage:</p><!-- Crayon Syntax Highlighter v2.6.10 -->

		<div id="crayon-551a86aee1a41571197550" class="crayon-syntax crayon-theme-dark-terminal-copy crayon-font-monospace crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style="margin-top: -6px; margin-bottom: 12px; margin-left: 12px; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -18px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-551a86aee1a41571197550-1">1</div><div class="crayon-num" data-line="crayon-551a86aee1a41571197550-2">2</div><div class="crayon-num" data-line="crayon-551a86aee1a41571197550-3">3</div><div class="crayon-num" data-line="crayon-551a86aee1a41571197550-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-551a86aee1a41571197550-1"><span class="crayon-sy">[</span>jensd<span class="crayon-sy">@</span>node02<span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-sy">]</span><span class="crayon-sy">$</span><span class="crayon-h"> </span>curl<span class="crayon-h"> </span>http<span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span>192<span class="crayon-sy">.</span>168<span class="crayon-sy">.</span>202<span class="crayon-sy">.</span>100</div><div class="crayon-line" id="crayon-551a86aee1a41571197550-2"><span class="crayon-o">&lt;</span>html<span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-551a86aee1a41571197550-3"><span class="crayon-h"> </span><span class="crayon-o">&lt;</span>h1<span class="crayon-o">&gt;</span>DRBD<span class="crayon-o">&lt;</span><span class="crayon-o">/</span>h1<span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-551a86aee1a41571197550-4"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span>html<span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>The above example was made for a webserver but can be used for 
various other services too. Unfortunately DRBD isn’t really supported as
 it should on RHEL or CentOS (at least not for free) so we need to 
perform some additional steps in order to get things working.</p>

<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:none;margin:10px 0 10px 0;text-align:center;">
<script async="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/adsbygoogle.js"></script>
<!-- lang -->
<ins data-adsbygoogle-status="done" class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-9938673978146131" data-ad-slot="9145919804"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;" frameborder="0" height="90" width="728"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<div style="font-size:0px;height:0px;line-height:0px;margin:0;padding:0;clear:both"></div>			</div><!-- .entry-content -->

	<footer class="entry-meta">
		This entry was posted in <a href="http://jensd.be/?cat=11" rel="category">Apache</a>, <a href="http://jensd.be/?cat=8" rel="category">CentOS</a>, <a href="http://jensd.be/?cat=10" rel="category">High availability</a>, <a href="http://jensd.be/?cat=3" rel="category">Linux</a>, <a href="http://jensd.be/?cat=25" rel="category">Network</a>, <a href="http://jensd.be/?cat=7" rel="category">Red Hat</a>, <a href="http://jensd.be/?cat=6" rel="category">RHEL</a> by <a href="http://jensd.be/?author=1">jensd</a>. Bookmark the <a href="http://jensd.be/?p=186" title="Permalink to Use DRBD in a cluster with Corosync and Pacemaker on CentOS 7" rel="bookmark">permalink</a>.		
			</footer><!-- .entry-meta -->
</article><!-- #post-186 -->

						<div id="comments">
	
	
			<h2 id="comments-title">
			15 thoughts on “<span>Use DRBD in a cluster with Corosync and Pacemaker on CentOS 7</span>”		</h2>

		
		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-8493">
		<article id="comment-8493" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/be34d559604569d644ec71d6f2b47d26_002.png" class="avatar avatar-68 photo" height="68" width="68"><span class="fn">Maik</span> on <a href="http://jensd.be/?p=186#comment-8493"><time datetime="2014-12-30T10:49:10+00:00">30/12/2014 at 10:49</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hi, I followed your tutorial, but I am stucking now when initializing the data.</p>
<p># sudo drbdadm create-md drbd0<br>
‘drbd0′ not defined in your config (for this host).</p>
<p>Any idea?</p>
<p>Thanks</p>
<p>Maik</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=8493#respond" onclick='return addComment.moveForm( "comment-8493", "8493", "respond", "186" )' aria-label="Reply to Maik">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jensd bypostauthor odd alt depth-2" id="li-comment-8494">
		<article id="comment-8494" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/ee3c0f3450ef086a09bef8c5e7945794.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">jensd</span> on <a href="http://jensd.be/?p=186#comment-8494"><time datetime="2014-12-30T10:51:51+00:00">30/12/2014 at 10:51</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Maik,</p>
<p>Check the config in /etc/drbd.d/drbd0.res. Maybe a syntax error? My best guess is that the problem is situated there.</p>
<p>Let me know if that helps.</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=8494#respond" onclick='return addComment.moveForm( "comment-8494", "8494", "respond", "186" )' aria-label="Reply to jensd">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment even depth-3" id="li-comment-8550">
		<article id="comment-8550" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/be34d559604569d644ec71d6f2b47d26.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">Maik</span> on <a href="http://jensd.be/?p=186#comment-8550"><time datetime="2015-01-01T10:16:58+00:00">01/01/2015 at 10:16</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Thanks for your reply.<br>
I fixed it myself. Next time I should take more care about the hostnames at the config…..<br>
I got it working exactly the way you explained, but I had to stop 
iptables to get the disk sync working. Maybe you made a mistake with the
 ports, you opened?</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=8550#respond" onclick='return addComment.moveForm( "comment-8550", "8550", "respond", "186" )' aria-label="Reply to Maik">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-8719">
		<article id="comment-8719" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/3c29d7146d4eeecfcd96581e46642c23.png" class="avatar avatar-68 photo" height="68" width="68"><span class="fn">Piko</span> on <a href="http://jensd.be/?p=186#comment-8719"><time datetime="2015-01-07T17:02:27+00:00">07/01/2015 at 17:02</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Nice … all is working well, I added 
virtual IP and FileSystem (start file system, then VirtualIP …. and all I
 need is NFS configuration to have complete HA storage)</p>
<p>is there tutorial or something to add NFS share (to be 
high-avaliable) on configuration in tutorial here …. I need PCS cib for 
NFS, all I can find is crm_shell</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=8719#respond" onclick='return addComment.moveForm( "comment-8719", "8719", "respond", "186" )' aria-label="Reply to Piko">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jensd bypostauthor even depth-2" id="li-comment-8720">
		<article id="comment-8720" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/ee3c0f3450ef086a09bef8c5e7945794.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">jensd</span> on <a href="http://jensd.be/?p=186#comment-8720"><time datetime="2015-01-07T17:05:32+00:00">07/01/2015 at 17:05</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Don’t know if a CIB exists for NFS 
but I would think that the IP failover in combination with shared 
storage (with DRBD) should be enough to make your NFS-share high 
available. The NFS-client shouldn’t really experience problems in case 
of failover and the IP and data stays the same.</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=8720#respond" onclick='return addComment.moveForm( "comment-8720", "8720", "respond", "186" )' aria-label="Reply to jensd">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment odd alt depth-3" id="li-comment-8724">
		<article id="comment-8724" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/45c67caeb1a737ce41955c9675b3490f.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">Piko</span> on <a href="http://jensd.be/?p=186#comment-8724"><time datetime="2015-01-07T23:40:12+00:00">07/01/2015 at 23:40</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I actually try to adopt <a href="https://www.howtoforge.com/high_availability_nfs_drbd_heartbeat_p3" rel="nofollow">https://www.howtoforge.com/high_availability_nfs_drbd_heartbeat_p3</a>
 to your HA tutorial …. To add NFS failover to another node …. I stuck 
at creating pcs resource for NFS server …. I try to start drbd_fs then 
VirtualIP than NFS share on primary node…. And on stoping primary node 
that all services failover on another node…. Drbd_fs and VirtualIP are 
automaticly started od another node, …. But I cannot figure NFS 
failover….</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=8724#respond" onclick='return addComment.moveForm( "comment-8724", "8724", "respond", "186" )' aria-label="Reply to Piko">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jensd bypostauthor even depth-4" id="li-comment-8732">
		<article id="comment-8732" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/ee3c0f3450ef086a09bef8c5e7945794.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">jensd</span> on <a href="http://jensd.be/?p=186#comment-8732"><time datetime="2015-01-08T09:44:04+00:00">08/01/2015 at 09:44</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I’ll have a look when I find some time (biggest problem at the moment) and let you know :)</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=8732#respond" onclick='return addComment.moveForm( "comment-8732", "8732", "respond", "186" )' aria-label="Reply to jensd">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-8876">
		<article id="comment-8876" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/b32e711ffd364bfa536bbd83386d7d64.png" class="avatar avatar-68 photo" height="68" width="68"><span class="fn">John</span> on <a href="http://jensd.be/?p=186#comment-8876"><time datetime="2015-01-14T18:16:32+00:00">14/01/2015 at 18:16</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Fantastic Tutorial! Worked like a 
charm. Any chance you might have a tutorial on how to setup drbd in a 
primary/primary pcs cluster?</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=8876#respond" onclick='return addComment.moveForm( "comment-8876", "8876", "respond", "186" )' aria-label="Reply to John">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-9217">
		<article id="comment-9217" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/baf4a9cb2c13d6ba182cd143bb872d21.png" class="avatar avatar-68 photo" height="68" width="68"><span class="fn">Rodommoc</span> on <a href="http://jensd.be/?p=186#comment-9217"><time datetime="2015-02-06T16:22:19+00:00">06/02/2015 at 16:22</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Im setting up a ESXi cluster web/file
 server with a shared HDD. It was working until I went to setup the 
DRBD. I had to restore the 2nd server from backup now I’m getting this:</p>
<p>[root@ATCServer01 ~]# sudo pcs status<br>
Cluster name: cluster_web<br>
Last updated: Fri Feb  6 09:05:47 2015<br>
Last change: Fri Feb  6 06:38:20 2015 via cibadmin on ATCServer01<br>
Stack: corosync<br>
Current DC: ATCServer01 (1) – partition with quorum<br>
Version: 1.1.10-32.el7_0.1-368c726<br>
2 Nodes configured<br>
4 Resources configured</p>
<p>Online: [ ATCServer01 ATCServer02 ]</p>
<p>Full list of resources:</p>
<p> virtual_ip     (ocf::heartbeat:IPaddr2):       Started ATCServer01<br>
 webserver      (ocf::heartbeat:apache):        Started ATCServer01<br>
 Master/Slave Set: webserver_data_sync [webserver_data]<br>
     webserver_data     (ocf::linbit:drbd):     FAILED ATCServer02 (unmanaged)<br>
     Masters: [ ATCServer01 ]</p>
<p>Failed actions:<br>
    webserver_data_stop_0 on ATCServer02 ‘not installed’ (5): call=18, 
status=complete, last-rc-change=’Fri Feb  6 09:00:55 2015′, 
queued=15281ms, exec=0ms</p>
<p>PCSD Status:<br>
  ATCServer01: Online<br>
  ATCServer02: Online</p>
<p>Daemon Status:<br>
  corosync: active/enabled<br>
  pacemaker: active/enabled<br>
  pcsd: active/enabled<br>
[root@ATCServer01 ~]# sudo crm_verify -L -V<br>
   error: unpack_rsc_op:        No further recovery can be attempted for
 webserver_data:1: stop action failed with ‘not installed’ (5)</p>
<p>I ran: sudo tail -100 /var/log/audit/audit.log|grep AVC|tail -1|audit2allow -M drdb_1<br>
The reply is there is nothing to do</p>
<p>[root@ATCServer02 ~]# sudo ls -al /var/lib/pacemaker/cores<br>
total 0<br>
drwxrwxrwx. 2 hacluster haclient  6 Feb  6 08:36 .<br>
drwxr-x—. 6 hacluster haclient 57 Feb  5 12:09 ..</p>
<p>[root@ATCServer02 ~]# sudo drbd-overview<br>
 0:drbd0/0  Unconfigured . .</p>
<p>[root@ATCServer02 ~]# sudo drbdadm up drbd0<br>
 –==  Thank you for participating in the global usage survey  ==–<br>
The server’s response is:<br>
node already registered</p>
<p>I have been working on this for 2 days and can’t figure it out. I 
should let you know I’m noob with Linux.  any help would be much 
appreciated, Thank you!!</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=9217#respond" onclick='return addComment.moveForm( "comment-9217", "9217", "respond", "186" )' aria-label="Reply to Rodommoc">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-9611">
		<article id="comment-9611" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/cbbe2518ff47d2fd325fc055071f0a10.png" class="avatar avatar-68 photo" height="68" width="68"><span class="fn">swen</span> on <a href="http://jensd.be/?p=186#comment-9611"><time datetime="2015-03-11T12:53:21+00:00">11/03/2015 at 12:53</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Great tutorial. Any answer for the NFS HA configuration?</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=9611#respond" onclick='return addComment.moveForm( "comment-9611", "9611", "respond", "186" )' aria-label="Reply to swen">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment even depth-2" id="li-comment-9677">
		<article id="comment-9677" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/45c67caeb1a737ce41955c9675b3490f.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">Piko</span> on <a href="http://jensd.be/?p=186#comment-9677"><time datetime="2015-03-15T00:51:50+00:00">15/03/2015 at 00:51</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Still nothing on HA NFS. But it would
 be nice to add similar tutorial for creating active/active DRBD with 
GFS2… That configuration would be more usuable in cluster enviroment for
 KVM/XEN live migrations (I use KVM) … and also, better solution than 
Primary/Secondary solution with NFS since there is less network 
operations since every host access shared storage as “local” disk, not 
as NFS (so no need for shared IP, no need to setup NFS, less network 
dataflow, and performace for two-node wold be better that way). Data on 
disks would be qcow images accessed only form one server (no metter 
which one), and both host can have live KVM machines (ex. 5 KVM on 
node1, 5 on node2, if needed I can migrate all to one host, perform 
restart or upgrade on another host, afther restart live migrate all or 
some to restarted/upgraded host). </p>
<p>That way two node host would be more usuable, and not just backup 
copy of disk. Network bandwich is better utilised since KVM machines are
 on both hosts (each have network on their host) and only disk data is 
synchronized. </p>
<p>Primary/Secondary have most network on one host, and other host only 
get disk synchronized. If I setup NFS on that scenario all network for 
NFS shares goes to primary. Having KVM machines on secondary host that 
access that NFS disk make additional NFS network data to primary which 
sync that bata back to secondary. Lots of unneccecary network data back 
and forth…. Using GFS saves bandwich for other better uses. So I’ll 
rather try to setup Active/Active setup…. </p>
<p> It would be nice that someone more expirienced than I create tutorial….</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=9677#respond" onclick='return addComment.moveForm( "comment-9677", "9677", "respond", "186" )' aria-label="Reply to Piko">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment odd alt depth-3" id="li-comment-9679">
		<article id="comment-9679" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/45c67caeb1a737ce41955c9675b3490f.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">Piko</span> on <a href="http://jensd.be/?p=186#comment-9679"><time datetime="2015-03-15T01:01:12+00:00">15/03/2015 at 01:01</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I forgot to mention that I already 
tryed GlusterFS and for some time it was working fine, but I had serious
 loose of data after upgrade of Gluster packages on CentOS7 (could not 
mount Gluster disk, all blame on forums was on CentOS gluster packages 
and their versioning but no any usuable solution for fixing that and get
 running again), … </p>
<p>Never loost byte using DRBD so Gluster will never see me again.</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=9679#respond" onclick='return addComment.moveForm( "comment-9679", "9679", "respond", "186" )' aria-label="Reply to Piko">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment byuser comment-author-jensd bypostauthor even depth-3" id="li-comment-9707">
		<article id="comment-9707" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/ee3c0f3450ef086a09bef8c5e7945794.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">jensd</span> on <a href="http://jensd.be/?p=186#comment-9707"><time datetime="2015-03-16T13:31:42+00:00">16/03/2015 at 13:31</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>As for Active/Active, I tried this 
quite intensive with Corosync and Pacemaker but in a corporate 
environment, I always seems to struggle with the network. </p>
<p>Active/Active works with multicast MAC (yes, this isn’t a typo, such 
dinosaurs actually exist). The packages destined for the virtual IP will
 be forwarded to both nodes in the cluster but  an iptables rule 
(CLUSTERIP) will filter these based on a hash of the source ip/port. The
 multicast MAC seems to confuse a lot of switches on ARP level. In 
theory enabling IGMP snooping should fix this but I never really got it 
working to a level where I fully trust it.</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=9707#respond" onclick='return addComment.moveForm( "comment-9707", "9707", "respond", "186" )' aria-label="Reply to jensd">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-9843">
		<article id="comment-9843" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/8de597f5cc563a453ca419132bb2b2c8.png" class="avatar avatar-68 photo" height="68" width="68"><span class="fn">Chris</span> on <a href="http://jensd.be/?p=186#comment-9843"><time datetime="2015-03-26T13:40:51+00:00">26/03/2015 at 13:40</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>webserver      (ocf::heartbeat:apache):        Stopped</p>
<p>Failed actions:<br>
    webserver_start_0 on centos01 ‘unknown error’ (1): call=22, 
status=Timed Out, last-rc-change=’Thu Mar 26 19:31:45 2015′, 
queued=40002ms, exec=0ms</p>
<p>can anyone help? which part I should look for solution? The apache is running fine…</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=9843#respond" onclick='return addComment.moveForm( "comment-9843", "9843", "respond", "186" )' aria-label="Reply to Chris">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jensd bypostauthor even depth-2" id="li-comment-9844">
		<article id="comment-9844" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/ee3c0f3450ef086a09bef8c5e7945794.png" class="avatar avatar-39 photo" height="39" width="39"><span class="fn">jensd</span> on <a href="http://jensd.be/?p=186#comment-9844"><time datetime="2015-03-26T13:43:15+00:00">26/03/2015 at 13:43</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>This looks like something is wrong 
with the status page which you configured for you webserver. Are you 
able to fetch the page yourself (with wget or curl) using the correct 
IP?</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://jensd.be/?p=186&amp;replytocom=9844#respond" onclick='return addComment.moveForm( "comment-9844", "9844", "respond", "186" )' aria-label="Reply to jensd">Reply <span>↓</span></a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		</ol>

		
		
	
									<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://jensd.be/?p=186#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://jensd.be/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																			<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" size="30" aria-required="true" type="text"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" size="30" aria-describedby="email-notes" aria-required="true" type="text"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" size="30" type="text"></p>
												<p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" aria-describedby="form-allowed-tags" aria-required="true"></textarea></p>						<p class="form-allowed-tags" id="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:  <code>&lt;a
 href="" title=""&gt; &lt;abbr title=""&gt; &lt;acronym title=""&gt; 
&lt;b&gt; &lt;blockquote cite=""&gt; &lt;cite&gt; &lt;code class="" 
title="" data-url=""&gt; &lt;del datetime=""&gt; &lt;em&gt; &lt;i&gt; 
&lt;q cite=""&gt; &lt;strike&gt; &lt;strong&gt; &lt;pre class="" 
title="" data-url=""&gt; &lt;span class="" title="" data-url=""&gt; </code></p>						<p class="form-submit">
							<input name="submit" id="submit" class="submit" value="Post Comment" type="submit">
							<input name="comment_post_ID" value="186" id="comment_post_ID" type="hidden">
<input name="comment_parent" id="comment_parent" value="0" type="hidden">
						</p>
						<p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" value="22fcd687f0" type="hidden"></p><p style="display: none;"></p>					<input id="ak_js" name="ak_js" value="1427801626330" type="hidden"></form>
							</div><!-- #respond -->
			
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			

			<div id="site-generator">
								<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/form.js"></script>
<script type="text/javascript" src="Use%20DRBD%20in%20a%20cluster%20with%20Corosync%20and%20Pacemaker%20on%20CentOS%207%20%7C%20Jensd%27s%20I_O%20buffer_files/comment-reply.js"></script>


<iframe style="display: none; width: 0px; height: 0px;" name="google_osd_static_frame" id="google_osd_static_frame_3077995093046"></iframe></body></html>